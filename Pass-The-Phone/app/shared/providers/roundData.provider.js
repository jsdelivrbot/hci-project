"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Sqlite = require("nativescript-sqlite");
var RoundDataProvider = /** @class */ (function () {
    function RoundDataProvider() {
        // (new Sqlite("passthephone.db")).then(db => {
        //     db.execSQL("CREATE TABLE IF NOT EXISTS players (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, group_id TEXT)").then(id => {
        //         this.database = db;
        //     }, error => {
        //         console.log("CREATE TABLE ERROR", error);
        //     });
        // }, error => {
        //     console.log("OPEN DB ERROR", error);
        // });
        this.players = [];
        this.groups = [];
        this.teams = [];
        this.answerCount = 2;
        this.playersInRound = [];
        this.groupFetch_completed = false;
        this.hasRemainingPlayers = true;
        // (new Sqlite("passthephone.db")).then(db => {
        //     db.execSQL("CREATE TABLE IF NOT EXISTS groups (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)").then(id => {
        //         this.database = db;
        //     }, error => {
        //         console.log("CREATE TABLE ERROR", error);
        //     });
        // }, error => {
        //     console.log("OPEN DB ERROR", error);
        // });
    }
    // Return a player that haven't played more than authorizes times
    // Returns null if no elligible player. Hence need to go to summary page
    RoundDataProvider.prototype.getRandomPlayer = function () {
        var elligiblePlayers = [];
        var j = 0;
        var k = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].answerCount < this.answerCount) {
                if (this.playersInRound.indexOf(this.players[i].name) < 0 && (this.currentPlayer == null || this.players[i].name != this.currentPlayer.name)) {
                    elligiblePlayers[k] = this.players[i];
                    k++;
                }
                j++;
            }
        }
        if (j == 0) {
            return null;
        }
        else {
            this.hasRemainingPlayers = j > 1;
            console.log(j > 1);
            var random = Math.floor(Math.random() * k);
            this.playersInRound.push(elligiblePlayers[random].name);
            if (this.playersInRound.length == this.players.length) {
                console.log("round done");
                this.playersInRound = [];
            }
            return elligiblePlayers[random];
        }
    };
    RoundDataProvider.prototype.calculateTeamCount = function () {
        var teamCount = 0;
        if ((this.players.length % 2 == 0 || this.players.length % 3 == 0) && this.players.length > 3) {
            //team creation of 2 or 3 player is possible
            if (this.players.length % 3 == 0) {
                //teams of 3 will be created
                teamCount = this.players.length / 3;
            }
            else {
                //teams of 2 will be created
                teamCount = this.players.length / 2;
            }
            return teamCount;
        }
        else {
            // no team creation is possible
            return 0;
        }
    };
    RoundDataProvider.prototype.getPlayersInTeam = function (team) {
        return team.players;
    };
    RoundDataProvider.prototype.getExistingAndRemainingPlayers = function (team) {
        var noTeamPlayers = [];
        var j = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].team == null /*|| this.players[i].team == team*/) {
                noTeamPlayers[j] = this.players[i];
                j++;
            }
            else if (this.players[i].team.name == team.name) {
                this.players[i].isSelected = true;
                noTeamPlayers[j] = this.players[i];
                j++;
            }
        }
        return noTeamPlayers;
    };
    RoundDataProvider.prototype.clearData = function () {
        console.log("Clearing Data...");
        this.triviaQuestion = null;
        this.currentPlayer = null;
        this.group = null;
        for (var i = 0; i < this.players.length; i++) {
            delete this.players[i];
        }
        for (var i = 0; i < this.teams.length; i++) {
            delete this.teams[i];
        }
        this.players = [];
        this.teams = [];
        this.subjectId = "";
        this.gameMode = "";
    };
    RoundDataProvider = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], RoundDataProvider);
    return RoundDataProvider;
}());
exports.RoundDataProvider = RoundDataProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmREYXRhLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91bmREYXRhLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBUTVDO0lBd0JJO1FBQ0ksK0NBQStDO1FBQy9DLHFJQUFxSTtRQUNySSw4QkFBOEI7UUFDOUIsb0JBQW9CO1FBQ3BCLG9EQUFvRDtRQUNwRCxVQUFVO1FBQ1YsZ0JBQWdCO1FBQ2hCLDJDQUEyQztRQUMzQyxNQUFNO1FBNUJILFlBQU8sR0FBYyxFQUFFLENBQUM7UUFDeEIsV0FBTSxHQUFhLEVBQUUsQ0FBQztRQUN0QixVQUFLLEdBQVksRUFBRSxDQUFDO1FBUWxCLGdCQUFXLEdBQVUsQ0FBQyxDQUFDO1FBRXpCLG1CQUFjLEdBQWEsRUFBRSxDQUFBO1FBSTdCLHlCQUFvQixHQUFZLEtBQUssQ0FBQztRQXlCdEMsd0JBQW1CLEdBQVksSUFBSSxDQUFDO1FBWHZDLCtDQUErQztRQUMvQyxxSEFBcUg7UUFDckgsOEJBQThCO1FBQzlCLG9CQUFvQjtRQUNwQixvREFBb0Q7UUFDcEQsVUFBVTtRQUNWLGdCQUFnQjtRQUNoQiwyQ0FBMkM7UUFDM0MsTUFBTTtJQUNWLENBQUM7SUFJRCxpRUFBaUU7SUFDakUsd0VBQXdFO0lBQ2pFLDJDQUFlLEdBQXRCO1FBQ0ksSUFBSSxnQkFBZ0IsR0FBYyxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1Ysa0NBQWtDO1FBQ2xDLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUEsQ0FBQyxJQUFJLENBQUMs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QUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUUsRUFBQyxDQUFDO1lBQ3ZDLE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQixDQUFDO1FBRUQsR0FBRyxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRSxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUUsRUFBQyxDQUFDO1lBQ3JDLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN6QixDQUFDO1FBRUQsSUFBSSxDQUFDLE9BQU8sR0FBRSxFQUFFLENBQUM7UUFDakIsSUFBSSxDQUFDLEtBQUssR0FBRSxFQUFFLENBQUM7UUFFZixJQUFJLENBQUMsU0FBUyxHQUFFLEVBQUUsQ0FBQztRQUVuQixJQUFJLENBQUMsUUFBUSxHQUFFLEVBQUUsQ0FBQztJQUN0QixDQUFDO0lBL0lRLGlCQUFpQjtRQUQ3QixpQkFBVSxFQUFFOztPQUNBLGlCQUFpQixDQXVPN0I7SUFBRCx3QkFBQztDQUFBLEFBdk9ELElBdU9DO0FBdk9ZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbnZhciBTcWxpdGUgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiKTtcblxuaW1wb3J0IHtUcml2aWFRdWVzdGlvbn0gZnJvbSBcIi4uL3RyaXZpYVF1ZXN0aW9uXCI7XG5pbXBvcnQge1RlYW19IGZyb20gXCIuLi90ZWFtXCI7XG5pbXBvcnQge1BsYXllcn0gZnJvbSBcIi4uL3BsYXllclwiO1xuaW1wb3J0IHtHcm91cH0gZnJvbSBcIi4uL2dyb3VwXCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSb3VuZERhdGFQcm92aWRlciB7XG4gICAgXG4gICAgcHVibGljIHRyaXZpYVF1ZXN0aW9uOiBUcml2aWFRdWVzdGlvbjtcbiAgICBwdWJsaWMgY3VycmVudFBsYXllcjogUGxheWVyO1xuICAgIHB1YmxpYyBncm91cDogR3JvdXA7XG4gICAgcHVibGljIHBsYXllcnMgOiBQbGF5ZXJbXSA9IFtdO1xuICAgIHB1YmxpYyBncm91cHMgOiBHcm91cFtdID0gW107ICAgIFxuICAgIHB1YmxpYyB0ZWFtcyA6IFRlYW1bXSA9IFtdO1xuICAgIFxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmc7XG4gICAgXG4gICAgcHVibGljIHN1YmplY3RJZDogc3RyaW5nO1xuICAgIFxuICAgIHB1YmxpYyBnYW1lTW9kZTogc3RyaW5nO1xuICAgIFxuICAgIHJlYWRvbmx5IGFuc3dlckNvdW50Om51bWJlciA9IDI7XG5cbiAgICBwdWJsaWMgcGxheWVyc0luUm91bmQ6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBwcml2YXRlIGRhdGFiYXNlOiBhbnk7XG5cbiAgICBwdWJsaWMgZ3JvdXBGZXRjaF9jb21wbGV0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBcbiAgICBcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIChuZXcgU3FsaXRlKFwicGFzc3RoZXBob25lLmRiXCIpKS50aGVuKGRiID0+IHtcbiAgICAgICAgLy8gICAgIGRiLmV4ZWNTUUwoXCJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBwbGF5ZXJzIChpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsIG5hbWUgVEVYVCwgZ3JvdXBfaWQgVEVYVClcIikudGhlbihpZCA9PiB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAvLyAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1JFQVRFIFRBQkxFIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9LCBlcnJvciA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhcIk9QRU4gREIgRVJST1JcIiwgZXJyb3IpO1xuICAgICAgICAvLyB9KTtcbiAgICAgICAgXG4gICAgICAgIC8vIChuZXcgU3FsaXRlKFwicGFzc3RoZXBob25lLmRiXCIpKS50aGVuKGRiID0+IHtcbiAgICAgICAgLy8gICAgIGRiLmV4ZWNTUUwoXCJDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBncm91cHMgKGlkIElOVEVHRVIgUFJJTUFSWSBLRVkgQVVUT0lOQ1JFTUVOVCwgbmFtZSBURVhUKVwiKS50aGVuKGlkID0+IHtcbiAgICAgICAgLy8gICAgICAgICB0aGlzLmRhdGFiYXNlID0gZGI7XG4gICAgICAgIC8vICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgIC8vICAgICAgICAgY29uc29sZS5sb2coXCJDUkVBVEUgVEFCTEUgRVJST1JcIiwgZXJyb3IpO1xuICAgICAgICAvLyAgICAgfSk7XG4gICAgICAgIC8vIH0sIGVycm9yID0+IHtcbiAgICAgICAgLy8gICAgIGNvbnNvbGUubG9nKFwiT1BFTiBEQiBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIC8vIH0pO1xuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgaGFzUmVtYWluaW5nUGxheWVyczogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvLyBSZXR1cm4gYSBwbGF5ZXIgdGhhdCBoYXZlbid0IHBsYXllZCBtb3JlIHRoYW4gYXV0aG9yaXplcyB0aW1lc1xuICAgIC8vIFJldHVybnMgbnVsbCBpZiBubyBlbGxpZ2libGUgcGxheWVyLiBIZW5jZSBuZWVkIHRvIGdvIHRvIHN1bW1hcnkgcGFnZVxuICAgIHB1YmxpYyBnZXRSYW5kb21QbGF5ZXIoKXtcbiAgICAgICAgdmFyIGVsbGlnaWJsZVBsYXllcnMgOiBQbGF5ZXJbXSA9IFtdO1xuICAgICAgICBsZXQgaiA9IDA7XG4gICAgICAgIGxldCBrID0gMDtcbiAgICAgICAgLy9wb3B1bGF0ZSBlbGxpZ2libGUgcGxheWVycyBhcnJheVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLnBsYXllcnMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0uYW5zd2VyQ291bnQ8dGhpcy5hbnN3ZXJDb3VudCl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzSW5Sb3VuZC5pbmRleE9mKHRoaXMucGxheWVyc1tpXS5uYW1lKSA8IDAgJiYgKHRoaXMuY3VycmVudFBsYXllciA9PSBudWxsIHx8IHRoaXMucGxheWVyc1tpXS5uYW1lICE9IHRoaXMuY3VycmVudFBsYXllci5uYW1lKSl7XG4gICAgICAgICAgICAgICAgICAgIGVsbGlnaWJsZVBsYXllcnNba109dGhpcy5wbGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgICAgICBrKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZihqID09IDApe1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgdGhpcy5oYXNSZW1haW5pbmdQbGF5ZXJzID0gaiA+IDE7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhqID4gMSlcbiAgICAgICAgICAgIGxldCByYW5kb20gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBrKTsgIFxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJzSW5Sb3VuZC5wdXNoKGVsbGlnaWJsZVBsYXllcnNbcmFuZG9tXS5uYW1lKVxuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzSW5Sb3VuZC5sZW5ndGggPT0gdGhpcy5wbGF5ZXJzLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyb3VuZCBkb25lXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzSW5Sb3VuZCA9IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZWxsaWdpYmxlUGxheWVyc1tyYW5kb21dO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBjYWxjdWxhdGVUZWFtQ291bnQoKXtcbiAgICAgICAgbGV0IHRlYW1Db3VudCA9IDA7XG4gICAgICAgIGlmKCAodGhpcy5wbGF5ZXJzLmxlbmd0aCUyID09IDAgfHwgdGhpcy5wbGF5ZXJzLmxlbmd0aCUzID09IDAgKSAmJiB0aGlzLnBsYXllcnMubGVuZ3RoID4gMykge1xuICAgICAgICAgICAgLy90ZWFtIGNyZWF0aW9uIG9mIDIgb3IgMyBwbGF5ZXIgaXMgcG9zc2libGVcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVycy5sZW5ndGglMyA9PSAwICl7XG4gICAgICAgICAgICAgICAgLy90ZWFtcyBvZiAzIHdpbGwgYmUgY3JlYXRlZFxuICAgICAgICAgICAgICAgIHRlYW1Db3VudCA9IHRoaXMucGxheWVycy5sZW5ndGgvMztcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIC8vdGVhbXMgb2YgMiB3aWxsIGJlIGNyZWF0ZWRcbiAgICAgICAgICAgICAgICB0ZWFtQ291bnQgPSB0aGlzLnBsYXllcnMubGVuZ3RoLzI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdGVhbUNvdW50O1xuICAgICAgICAgICAgXG4gICAgICAgIH1lbHNle1xuICAgICAgICAgICAgLy8gbm8gdGVhbSBjcmVhdGlvbiBpcyBwb3NzaWJsZVxuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgfVxuXG4gICAgcHVibGljIGdldFBsYXllcnNJblRlYW0odGVhbTogVGVhbSk6IFBsYXllcltde1xuICAgICAgICByZXR1cm4gdGVhbS5wbGF5ZXJzO1xuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgZ2V0RXhpc3RpbmdBbmRSZW1haW5pbmdQbGF5ZXJzKHRlYW06IFRlYW0pOiBQbGF5ZXJbXXtcbiAgICAgICAgdmFyIG5vVGVhbVBsYXllcnMgOiBQbGF5ZXJbXSA9IFtdO1xuICAgICAgICBsZXQgaiA9IDA7XG4gICAgICAgIFxuICAgICAgICAvL3BvcHVsYXRlIGVsbGlnaWJsZSBwbGF5ZXJzIGFycmF5XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMucGxheWVycy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVyc1tpXS50ZWFtID09IG51bGwgLyp8fCB0aGlzLnBsYXllcnNbaV0udGVhbSA9PSB0ZWFtKi8gKXtcbiAgICAgICAgICAgICAgICBub1RlYW1QbGF5ZXJzW2pdPXRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYodGhpcy5wbGF5ZXJzW2ldLnRlYW0ubmFtZSA9PSAgdGVhbS5uYW1lKXtcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNbaV0uaXNTZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgbm9UZWFtUGxheWVyc1tqXT10aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gbm9UZWFtUGxheWVycztcbiAgICB9XG4gICAgXG4gICAgXG4gICAgcHVibGljIGNsZWFyRGF0YSgpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNsZWFyaW5nIERhdGEuLi5cIik7XG4gICAgICAgIHRoaXMudHJpdmlhUXVlc3Rpb24gPSBudWxsOyBcbiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyPSBudWxsO1xuICAgICAgICB0aGlzLmdyb3VwPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5wbGF5ZXJzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy50ZWFtcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnRlYW1zW2ldO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBsYXllcnM9IFtdO1xuICAgICAgICB0aGlzLnRlYW1zPSBbXTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc3ViamVjdElkPSBcIlwiO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5nYW1lTW9kZT0gXCJcIjtcbiAgICB9XG4gICAgXG4gICAgLy8gcHVibGljIGNsZWFyR3JvdXBzKCl7XG4gICAgICAgIFxuICAgIC8vICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLmdyb3Vwcy5sZW5ndGg7aSsrKXtcbiAgICAvLyAgICAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tpXTtcbiAgICAvLyAgICAgfVxuICAgICAgICBcbiAgICAvLyAgICAgdGhpcy5ncm91cHM9IFtdO1xuICAgIC8vIH1cbiAgICBcbi8vICAgICBwdWJsaWMgaW5zZXJ0X2dyb3VwKGdyb3VwOkdyb3VwKSB7ICAgICAgICBcbi8vICAgICAgICAgdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gZ3JvdXBzIChuYW1lKSBWQUxVRVMgKD8pXCIsIFtncm91cC5uYW1lXSkudGhlbihpZCA9PiB7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIklOU0VSVCBSRVNVTFRcIiwgaWQpO1xuLy8gICAgICAgICAgICAgZ3JvdXAuaWQ9aWQ7XG4vLyAgICAgICAgICAgICAvLyB0aGlzLmZldGNoKCk7XG4vLyAgICAgICAgICAgICB0aGlzLmluc2VydF9ncm91cF9wbGF5ZXJzKGdyb3VwKTtcbi8vICAgICAgICAgfSwgZXJyb3IgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1JcIiwgZXJyb3IpO1xuLy8gICAgICAgICB9KTtcbi8vICAgICB9XG4gICAgXG4vLyAgICAgcHJpdmF0ZSBpbnNlcnRfZ3JvdXBfcGxheWVycyhncm91cDpHcm91cCkge1xuICAgICAgICBcbi8vICAgICAgICAgbGV0IGluc2VydF9wbGF5ZXJzID0gZ3JvdXAucGxheWVycztcbiAgICAgICAgXG4vLyAgICAgICAgIGZvciAodmFyIHBsYXllciBvZiBpbnNlcnRfcGxheWVycyl7XG4vLyAgICAgICAgICAgICB0aGlzLmRhdGFiYXNlLmV4ZWNTUUwoXCJJTlNFUlQgSU5UTyBwbGF5ZXJzIChuYW1lLCBncm91cF9pZCkgVkFMVUVTICg/LCA/KVwiLCBbcGxheWVyLm5hbWUsIGdyb3VwLmlkXSkudGhlbihpZCA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUXCIsIGlkKTtcbi8vICAgICAgICAgICAgICAgICAvLyB0aGlzLmZldGNoKCk7XG4vLyAgICAgICAgICAgICB9LCBlcnJvciA9PiB7XG4vLyAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgRVJST1JcIiwgZXJyb3IpO1xuLy8gICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9XG4gICAgXG4vLyAgICAgcHVibGljIGZldGNoX2dyb3VwcygpIHtcbi8vICAgICAgICAgLy9UT0RPLiBGZXRjaCByZWNvc3RydWN0cyBvYmplY3RzIGJhc2VkIG9uIGlkLlxuICAgICAgICBcbi8vICAgICAgICAgY29uc29sZS5sb2coXCJmZXRjaGluZyBncm91cHMuLi5cIik7XG4gICAgICAgIFxuLy8gICAgICAgICAvLyB2YXIgdGhhdCA9IHRoaXM7XG4gICAgICAgIFxuLy8gICAgICAgICB0aGlzLmRhdGFiYXNlLmFsbChcIlNFTEVDVCAqIEZST00gZ3JvdXBzXCIpLnRoZW4ocm93cyA9PiB7XG4vLyAgICAgICAgICAgICB0aGlzLmdyb3VwcyA9IFtdO1xuLy8gICAgICAgICAgICAgZm9yKHZhciByb3cgaW4gcm93cykge1xuLy8gICAgICAgICAgICAgICAgIHRoaXMuZ3JvdXBzLnB1c2goe1xuLy8gICAgICAgICAgICAgICAgICAgICBcImlkXCI6cm93c1tyb3ddWzBdLFxuLy8gICAgICAgICAgICAgICAgICAgICBcIm5hbWVcIjpyb3dzW3Jvd11bMV0sXG4vLyAgICAgICAgICAgICAgICAgICAgIFwicGxheWVyc05hbWVcIjpcIlwiLFxuLy8gICAgICAgICAgICAgICAgICAgICBcInBsYXllcnNcIjpudWxsXG4vLyAgICAgICAgICAgICAgICAgfVxuLy8gICAgICAgICAgICAgKTtcbi8vICAgICAgICAgICAgIGxldCBsYXN0R3JvdXAgPSB0aGlzLmdyb3Vwc1t0aGlzLmdyb3Vwcy5sZW5ndGgtMV07XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5ldyBncm91cDogXCIrbGFzdEdyb3VwLm5hbWUpO1xuLy8gICAgICAgICAgICAgbGFzdEdyb3VwLnBsYXllcnM9IHRoaXMuZmV0Y2hfZ3JvdXBfcGxheWVycyhsYXN0R3JvdXApO1xuLy8gICAgICAgICB9XG4vLyAgICAgfSwgZXJyb3IgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4vLyAgICAgfSk7XG4vLyAgICAgdGhpcy5ncm91cEZldGNoX2NvbXBsZXRlZD10cnVlO1xuLy8gfVxuXG4vLyBwdWJsaWMgZmV0Y2hfZ3JvdXBfcGxheWVycyhncm91cDpHcm91cCl7XG4vLyAgICAgbGV0IGdyb3VwX3BsYXllcnM6IFBsYXllcltdPVtdO1xuICAgIFxuLy8gICAgIGNvbnNvbGUubG9nKFwiRmV0Y2hpbmcgZ3JvdXAgcGxheWVyczogXCIrZ3JvdXAuaWQpO1xuXG4gICAgXG4vLyAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIHBsYXllcnMgd2hlcmUgaWQgPSAxXCIpLnRoZW4ocm93cyA9PiB7XG4vLyAgICAgICAgIGdyb3VwX3BsYXllcnMgPSBbXTtcbi8vICAgICAgICAgZm9yKHZhciByb3cgaW4gcm93cykge1xuLy8gICAgICAgICAgICAgZ3JvdXBfcGxheWVycy5wdXNoKHtcbi8vICAgICAgICAgICAgICAgICBcImlkXCI6cm93c1tyb3ddWzBdLFxuLy8gICAgICAgICAgICAgICAgIFwibmFtZVwiOnJvd3Nbcm93XVsxXSxcbi8vICAgICAgICAgICAgICAgICBcImFuc3dlckNvdW50XCI6IDAsXG4vLyAgICAgICAgICAgICAgICAgXCJydW5uaW5nUG9pbnRzVG90YWxcIjogMCxcbi8vICAgICAgICAgICAgICAgICBcInRlYW1cIjogbnVsbCxcbi8vICAgICAgICAgICAgICAgICBcImlzU2VsZWN0ZWRcIjpmYWxzZVxuLy8gICAgICAgICAgICAgfSk7XG4vLyAgICAgICAgIH1cbi8vICAgICB9LCBlcnJvciA9PiB7XG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiU0VMRUNUIEVSUk9SXCIsIGVycm9yKTtcbi8vICAgICB9KTtcbiAgICBcbi8vICAgICByZXR1cm4gZ3JvdXBfcGxheWVycztcbi8vIH1cblxufSJdfQ==