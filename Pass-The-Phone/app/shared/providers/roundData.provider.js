"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_texttospeech_1 = require("nativescript-texttospeech");
var Sqlite = require("nativescript-sqlite");
var RoundDataProvider = /** @class */ (function () {
    function RoundDataProvider() {
        this.players = [];
        this.groups = [];
        this.teams = [];
        this.hasQuestions = false;
        this.answerCount = 2;
        this.playersInRound = [];
        this.groupFetch_completed = false;
        //set a default boolean for a button to animate when the tts plugin 'speaks'
        this.isSpeaking = false;
        this.hasRemainingPlayers = true;
        this.TTS = new nativescript_texttospeech_1.TNSTextToSpeech();
    }
    // Return a player that haven't played more than authorizes times
    // Returns null if no elligible player. Hence need to go to summary page
    RoundDataProvider.prototype.getRandomPlayer = function (questionAsker) {
        var elligiblePlayers = [];
        var j = 0;
        var k = 0;
        //populate elligible players array
        console.log("question asker: ".concat(questionAsker));
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].answerCount < this.answerCount) {
                console.log("question asker: ".concat(this.players[i].name));
                if (this.players[i].name != questionAsker && this.playersInRound.indexOf(this.players[i].name) < 0 && (this.currentPlayer == null || this.players[i].name != this.currentPlayer.name)) {
                    elligiblePlayers[k] = this.players[i];
                    k++;
                }
                j++;
            }
        }
        if (j == 0) {
            return null;
        }
        else {
            this.hasRemainingPlayers = j > 1;
            console.log(j > 1);
            var random = Math.floor(Math.random() * k);
            console.log("random ".concat((random).toString()));
            console.log("elligible ".concat((elligiblePlayers.length).toString()));
            this.playersInRound.push(elligiblePlayers[random].name);
            if (this.playersInRound.length == this.players.length) {
                console.log("round done");
                this.playersInRound = [];
            }
            return elligiblePlayers[random];
        }
    };
    //trouver un ami pour demander une question, code beurk
    RoundDataProvider.prototype.getRandomFriend = function (player) {
        var friends = [];
        player.team.players.forEach(function (p) {
            if (p.name != player.name) {
                friends.push(p);
            }
        });
        var index = Math.floor(Math.random() * friends.length);
        if (index > 0) {
            return friends[index].name;
        }
        else {
            return friends[0].name;
        }
    };
    RoundDataProvider.prototype.speak = function (text) {
        var _this = this;
        this.isSpeaking = true;
        var speakOptions = {
            text: text,
            speakRate: 0.5,
            pitch: 1,
            queue: true,
            finishedCallback: (function () {
                _this.isSpeaking = false;
            })
        };
        this.TTS.speak(speakOptions);
    };
    RoundDataProvider.prototype.stopSpeaking = function () {
        this.isSpeaking = false;
        this.TTS.destroy();
    };
    RoundDataProvider.prototype.calculateTeamCount = function () {
        var teamCount = 0;
        if ((this.players.length % 2 == 0 || this.players.length % 3 == 0) && this.players.length > 3) {
            //team creation of 2 or 3 player is possible
            if (this.players.length % 3 == 0) {
                //teams of 3 will be created
                teamCount = this.players.length / 3;
            }
            else {
                //teams of 2 will be created
                teamCount = this.players.length / 2;
            }
            return teamCount;
        }
        else {
            // no team creation is possible
            return 0;
        }
    };
    RoundDataProvider.prototype.getProgress = function () {
        var questionsAnswered = 0;
        this.players.forEach(function (player) {
            questionsAnswered += player.answerCount;
        });
        return (questionsAnswered / (this.answerCount * this.players.length)) * 100;
    };
    RoundDataProvider.prototype.getPlayersInTeam = function (team) {
        return team.players;
    };
    RoundDataProvider.prototype.getExistingAndRemainingPlayers = function (team) {
        var noTeamPlayers = [];
        var j = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].team == null /*|| this.players[i].team == team*/) {
                noTeamPlayers[j] = this.players[i];
                j++;
            }
            else if (this.players[i].team.name == team.name) {
                this.players[i].isSelected = true;
                noTeamPlayers[j] = this.players[i];
                j++;
            }
        }
        return noTeamPlayers;
    };
    RoundDataProvider.prototype.defineQuestionAsker = function () {
        this.questionAsker;
        return this.questionAsker;
    };
    RoundDataProvider.prototype.clearData = function () {
        console.log("Clearing Data...");
        this.triviaQuestion = null;
        this.currentPlayer = null;
        this.group = null;
        for (var i = 0; i < this.players.length; i++) {
            delete this.players[i];
        }
        for (var i = 0; i < this.teams.length; i++) {
            delete this.teams[i];
        }
        this.players = [];
        this.teams = [];
        this.subjectId = "";
        this.gameMode = "";
    };
    RoundDataProvider = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], RoundDataProvider);
    return RoundDataProvider;
}());
exports.RoundDataProvider = RoundDataProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmREYXRhLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91bmREYXRhLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHVFQUEwRTtBQUMxRSxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQVU1QztJQW1DSTtRQTVCTyxZQUFPLEdBQWMsRUFBRSxDQUFDO1FBQ3hCLFdBQU0sR0FBYSxFQUFFLENBQUM7UUFDdEIsVUFBSyxHQUFZLEVBQUUsQ0FBQztRQUNwQixpQkFBWSxHQUFZLEtBQUssQ0FBQztRQVk1QixnQkFBVyxHQUFVLENBQUMsQ0FBQztRQUV6QixtQkFBYyxHQUFhLEVBQUUsQ0FBQTtRQUk3Qix5QkFBb0IsR0FBWSxLQUFLLENBQUM7UUFFN0MsNEVBQTRFO1FBQzVFLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFRckIsd0JBQW1CLEdBQVksSUFBSSxDQUFDO1FBSHZDLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSwyQ0FBZSxFQUFFLENBQUM7SUFDckMsQ0FBQztJQUlELGlFQUFpRTtJQUNqRSx3RUFBd0U7SUFDakUsMkNBQWUsR0FBdEIsVUFBdUIsYUFBYTtRQUNoQyxJQUFJLGdCQUFnQixHQUFjLEVBQUUsQ0FBQztRQUNyQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixrQ0FBa0M7UUFDbEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQTtRQUNyRCxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFDLENBQUM7WUFDdkMsRUFBRSxDQUFBLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENB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QUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFFLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxFQUFDLENBQUMsRUFBRSxFQUFDLENBQUM7WUFDckMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3pCLENBQUM7UUFFRCxJQUFJLENBQUMsT0FBTyxHQUFFLEVBQUUsQ0FBQztRQUNqQixJQUFJLENBQUMsS0FBSyxHQUFFLEVBQUUsQ0FBQztRQUVmLElBQUksQ0FBQyxTQUFTLEdBQUUsRUFBRSxDQUFDO1FBRW5CLElBQUksQ0FBQyxRQUFRLEdBQUUsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUE5TFEsaUJBQWlCO1FBRDdCLGlCQUFVLEVBQUU7O09BQ0EsaUJBQWlCLENBa003QjtJQUFELHdCQUFDO0NBQUEsQUFsTUQsSUFrTUM7QUFsTVksOENBQWlCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgVE5TVGV4dFRvU3BlZWNoLCBTcGVha09wdGlvbnMgfSBmcm9tICduYXRpdmVzY3JpcHQtdGV4dHRvc3BlZWNoJztcbnZhciBTcWxpdGUgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiKTtcblxuaW1wb3J0IHtUcml2aWFRdWVzdGlvbn0gZnJvbSBcIi4uL3RyaXZpYVF1ZXN0aW9uXCI7XG5pbXBvcnQge1RlYW19IGZyb20gXCIuLi90ZWFtXCI7XG5pbXBvcnQge1BsYXllcn0gZnJvbSBcIi4uL3BsYXllclwiO1xuaW1wb3J0IHtHcm91cH0gZnJvbSBcIi4uL2dyb3VwXCI7XG5cblxuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUm91bmREYXRhUHJvdmlkZXIge1xuICAgIFxuICAgIHB1YmxpYyB0cml2aWFRdWVzdGlvbjogVHJpdmlhUXVlc3Rpb247XG4gICAgcHVibGljIGN1cnJlbnRQbGF5ZXI6IFBsYXllcjtcbiAgICBwdWJsaWMgcXVlc3Rpb25Bc2tlcjogUGxheWVyO1xuICAgIFxuICAgIHB1YmxpYyBncm91cDogR3JvdXA7XG4gICAgcHVibGljIHBsYXllcnMgOiBQbGF5ZXJbXSA9IFtdO1xuICAgIHB1YmxpYyBncm91cHMgOiBHcm91cFtdID0gW107ICAgIFxuICAgIHB1YmxpYyB0ZWFtcyA6IFRlYW1bXSA9IFtdO1xuICAgIHB1YmxpYyBoYXNRdWVzdGlvbnM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwdWJsaWMgcGF0aDogc3RyaW5nO1xuICAgIHB1YmxpYyBxdWVzdGlvbnM6c3RyaW5nW107XG4gICAgcHVibGljIGFuc3dlcnM6W3N0cmluZ1tdXTtcbiAgICBwdWJsaWMgc3ViamVjdElkOiBzdHJpbmc7XG4gICAgcHVibGljIHN1YmplY3ROYW1lOiBzdHJpbmc7XG4gICAgcHVibGljIGNhdGVnb3J5OnN0cmluZztcbiAgICBwdWJsaWMgdHlwZTpzdHJpbmc7XG4gICAgcHVibGljIGRpZmZpY3VsdHk6c3RyaW5nO1xuICAgIFxuICAgIHB1YmxpYyBnYW1lTW9kZTogc3RyaW5nO1xuICAgIFxuICAgIHJlYWRvbmx5IGFuc3dlckNvdW50Om51bWJlciA9IDI7XG5cbiAgICBwdWJsaWMgcGxheWVyc0luUm91bmQ6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBwcml2YXRlIGRhdGFiYXNlOiBhbnk7XG5cbiAgICBwdWJsaWMgZ3JvdXBGZXRjaF9jb21wbGV0ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIC8vc2V0IGEgZGVmYXVsdCBib29sZWFuIGZvciBhIGJ1dHRvbiB0byBhbmltYXRlIHdoZW4gdGhlIHR0cyBwbHVnaW4gJ3NwZWFrcydcbiAgICBpc1NwZWFraW5nOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHJpdmF0ZSBUVFM6IFROU1RleHRUb1NwZWVjaDtcbiAgICBcbiAgICBcbiAgICBwdWJsaWMgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuVFRTID0gbmV3IFROU1RleHRUb1NwZWVjaCgpO1xuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgaGFzUmVtYWluaW5nUGxheWVyczogYm9vbGVhbiA9IHRydWU7XG5cbiAgICAvLyBSZXR1cm4gYSBwbGF5ZXIgdGhhdCBoYXZlbid0IHBsYXllZCBtb3JlIHRoYW4gYXV0aG9yaXplcyB0aW1lc1xuICAgIC8vIFJldHVybnMgbnVsbCBpZiBubyBlbGxpZ2libGUgcGxheWVyLiBIZW5jZSBuZWVkIHRvIGdvIHRvIHN1bW1hcnkgcGFnZVxuICAgIHB1YmxpYyBnZXRSYW5kb21QbGF5ZXIocXVlc3Rpb25Bc2tlcil7XG4gICAgICAgIHZhciBlbGxpZ2libGVQbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICBsZXQgayA9IDA7XG4gICAgICAgIC8vcG9wdWxhdGUgZWxsaWdpYmxlIHBsYXllcnMgYXJyYXlcbiAgICAgICAgY29uc29sZS5sb2coXCJxdWVzdGlvbiBhc2tlcjogXCIuY29uY2F0KHF1ZXN0aW9uQXNrZXIpKVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLnBsYXllcnMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0uYW5zd2VyQ291bnQ8dGhpcy5hbnN3ZXJDb3VudCl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJxdWVzdGlvbiBhc2tlcjogXCIuY29uY2F0KHRoaXMucGxheWVyc1tpXS5uYW1lKSlcbiAgICAgICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0ubmFtZSAhPSBxdWVzdGlvbkFza2VyICYmIHRoaXMucGxheWVyc0luUm91bmQuaW5kZXhPZih0aGlzLnBsYXllcnNbaV0ubmFtZSkgPCAwICYmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT0gbnVsbCB8fCB0aGlzLnBsYXllcnNbaV0ubmFtZSAhPSB0aGlzLmN1cnJlbnRQbGF5ZXIubmFtZSkpe1xuICAgICAgICAgICAgICAgICAgICBlbGxpZ2libGVQbGF5ZXJzW2tdPXRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgaysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoaiA9PSAwKXtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuaGFzUmVtYWluaW5nUGxheWVycyA9IGogPiAxO1xuICAgICAgICAgICAgY29uc29sZS5sb2coaiA+IDEpXG4gICAgICAgICAgICBsZXQgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogayk7IFxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJyYW5kb20gXCIuY29uY2F0KChyYW5kb20pLnRvU3RyaW5nKCkpKVxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJlbGxpZ2libGUgXCIuY29uY2F0KChlbGxpZ2libGVQbGF5ZXJzLmxlbmd0aCkudG9TdHJpbmcoKSkpXG4gICAgICAgICAgICB0aGlzLnBsYXllcnNJblJvdW5kLnB1c2goZWxsaWdpYmxlUGxheWVyc1tyYW5kb21dLm5hbWUpXG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNJblJvdW5kLmxlbmd0aCA9PSB0aGlzLnBsYXllcnMubGVuZ3RoKXtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJvdW5kIGRvbmVcIilcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcnNJblJvdW5kID0gW11cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBlbGxpZ2libGVQbGF5ZXJzW3JhbmRvbV07XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvL3Ryb3V2ZXIgdW4gYW1pIHBvdXIgZGVtYW5kZXIgdW5lIHF1ZXN0aW9uLCBjb2RlIGJldXJrXG4gICAgcHVibGljIGdldFJhbmRvbUZyaWVuZChwbGF5ZXI6IFBsYXllcil7XG4gICAgICAgIGxldCBmcmllbmRzID0gW107XG4gICAgICAgIHBsYXllci50ZWFtLnBsYXllcnMuZm9yRWFjaChwID0+IHtcbiAgICAgICAgICAgIGlmKHAubmFtZSAhPSBwbGF5ZXIubmFtZSl7XG4gICAgICAgICAgICAgICAgZnJpZW5kcy5wdXNoKHApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgbGV0IGluZGV4ID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmZyaWVuZHMubGVuZ3RoKTtcbiAgICAgICAgaWYoaW5kZXggPiAwKXtcbiAgICAgICAgICAgIHJldHVybiBmcmllbmRzW2luZGV4XS5uYW1lO1xuICAgICAgICB9IGVsc2V7XG4gICAgICAgICAgICByZXR1cm4gZnJpZW5kc1swXS5uYW1lO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHNwZWFrKHRleHQ6IHN0cmluZyl7XG4gICAgICAgIHRoaXMuaXNTcGVha2luZyA9IHRydWU7XG4gICAgICAgIGxldCBzcGVha09wdGlvbnM6IFNwZWFrT3B0aW9ucyA9IHtcbiAgICAgICAgICAgIHRleHQ6IHRleHQsXG4gICAgICAgICAgICBzcGVha1JhdGU6IDAuNSxcbiAgICAgICAgICAgIHBpdGNoOiAxLFxuICAgICAgICAgICAgcXVldWU6IHRydWUsXG4gICAgICAgICAgICBmaW5pc2hlZENhbGxiYWNrOiAoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaXNTcGVha2luZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSkgIFxuICAgICAgICB9XG4gICAgICAgIHRoaXMuVFRTLnNwZWFrKHNwZWFrT3B0aW9ucyk7XG4gICAgfVxuXG4gICAgcHVibGljIHN0b3BTcGVha2luZygpe1xuICAgICAgICB0aGlzLmlzU3BlYWtpbmcgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5UVFMuZGVzdHJveSgpO1xuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgY2FsY3VsYXRlVGVhbUNvdW50KCl7XG4gICAgICAgIGxldCB0ZWFtQ291bnQgPSAwO1xuICAgICAgICBpZiggKHRoaXMucGxheWVycy5sZW5ndGglMiA9PSAwIHx8IHRoaXMucGxheWVycy5sZW5ndGglMyA9PSAwICkgJiYgdGhpcy5wbGF5ZXJzLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIC8vdGVhbSBjcmVhdGlvbiBvZiAyIG9yIDMgcGxheWVyIGlzIHBvc3NpYmxlXG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnMubGVuZ3RoJTMgPT0gMCApe1xuICAgICAgICAgICAgICAgIC8vdGVhbXMgb2YgMyB3aWxsIGJlIGNyZWF0ZWRcbiAgICAgICAgICAgICAgICB0ZWFtQ291bnQgPSB0aGlzLnBsYXllcnMubGVuZ3RoLzM7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAvL3RlYW1zIG9mIDIgd2lsbCBiZSBjcmVhdGVkXG4gICAgICAgICAgICAgICAgdGVhbUNvdW50ID0gdGhpcy5wbGF5ZXJzLmxlbmd0aC8yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRlYW1Db3VudDtcbiAgICAgICAgICAgIFxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIG5vIHRlYW0gY3JlYXRpb24gaXMgcG9zc2libGVcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQcm9ncmVzcygpe1xuICAgICAgICB2YXIgcXVlc3Rpb25zQW5zd2VyZWQgOiBudW1iZXIgPSAwO1xuICAgICAgICB0aGlzLnBsYXllcnMuZm9yRWFjaChwbGF5ZXIgPT57XG4gICAgICAgICAgICBxdWVzdGlvbnNBbnN3ZXJlZCArPSBwbGF5ZXIuYW5zd2VyQ291bnQ7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gKHF1ZXN0aW9uc0Fuc3dlcmVkLyh0aGlzLmFuc3dlckNvdW50ICogdGhpcy5wbGF5ZXJzLmxlbmd0aCkpICogMTAwO1xuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQbGF5ZXJzSW5UZWFtKHRlYW06IFRlYW0pOiBQbGF5ZXJbXXtcbiAgICAgICAgcmV0dXJuIHRlYW0ucGxheWVycztcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGdldEV4aXN0aW5nQW5kUmVtYWluaW5nUGxheWVycyh0ZWFtOiBUZWFtKTogUGxheWVyW117XG4gICAgICAgIHZhciBub1RlYW1QbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICBcbiAgICAgICAgLy9wb3B1bGF0ZSBlbGxpZ2libGUgcGxheWVycyBhcnJheVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLnBsYXllcnMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0udGVhbSA9PSBudWxsIC8qfHwgdGhpcy5wbGF5ZXJzW2ldLnRlYW0gPT0gdGVhbSovICl7XG4gICAgICAgICAgICAgICAgbm9UZWFtUGxheWVyc1tqXT10aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMucGxheWVyc1tpXS50ZWFtLm5hbWUgPT0gIHRlYW0ubmFtZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2ldLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5vVGVhbVBsYXllcnNbal09dGhpcy5wbGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5vVGVhbVBsYXllcnM7XG4gICAgfVxuXG4gICAgcHVibGljIGRlZmluZVF1ZXN0aW9uQXNrZXIoKXtcblxuICAgICAgICB0aGlzLnF1ZXN0aW9uQXNrZXI7XG5cbiAgICAgICAgcmV0dXJuIHRoaXMucXVlc3Rpb25Bc2tlcjtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgcHVibGljIGNsZWFyRGF0YSgpe1xuICAgICAgICBjb25zb2xlLmxvZyhcIkNsZWFyaW5nIERhdGEuLi5cIik7XG4gICAgICAgIHRoaXMudHJpdmlhUXVlc3Rpb24gPSBudWxsOyBcbiAgICAgICAgdGhpcy5jdXJyZW50UGxheWVyPSBudWxsO1xuICAgICAgICB0aGlzLmdyb3VwPSBudWxsO1xuICAgICAgICBcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5wbGF5ZXJzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy50ZWFtcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnRlYW1zW2ldO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICB0aGlzLnBsYXllcnM9IFtdO1xuICAgICAgICB0aGlzLnRlYW1zPSBbXTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc3ViamVjdElkPSBcIlwiO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5nYW1lTW9kZT0gXCJcIjtcbiAgICB9XG4gICAgXG4gIFxuXG59Il19