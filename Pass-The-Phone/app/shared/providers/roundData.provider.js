"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var nativescript_texttospeech_1 = require("nativescript-texttospeech");
var Sqlite = require("nativescript-sqlite");
var file_system_1 = require("file-system");
var RoundDataProvider = /** @class */ (function () {
    function RoundDataProvider() {
        this.players = [];
        this.groups = [];
        this.teams = [];
        this.hasQuestions = false;
        this.answerCount = 2;
        this.playersInRound = [];
        this.groupFetch_completed = false;
        //set a default boolean for a button to animate when the tts plugin 'speaks'
        this.isSpeaking = false;
        this.hasRemainingPlayers = true;
        this.TTS = new nativescript_texttospeech_1.TNSTextToSpeech();
    }
    // Return a player that haven't played more than authorizes times
    // Returns null if no elligible player. Hence need to go to summary page
    RoundDataProvider.prototype.getRandomPlayer = function (questionAsker) {
        var elligiblePlayers = [];
        var j = 0;
        var k = 0;
        //populate elligible players array
        console.log("question asker: ".concat(questionAsker));
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].answerCount < this.answerCount) {
                console.log("question asker: ".concat(this.players[i].name));
                if (this.players[i].name != questionAsker && this.playersInRound.indexOf(this.players[i].name) < 0 && (this.currentPlayer == null || this.players[i].name != this.currentPlayer.name)) {
                    elligiblePlayers[k] = this.players[i];
                    k++;
                }
                j++;
            }
        }
        if (j == 0) {
            return null;
        }
        else {
            this.hasRemainingPlayers = j > 1;
            console.log(j > 1);
            var random = Math.floor(Math.random() * k);
            console.log("random ".concat((random).toString()));
            console.log("elligible ".concat((elligiblePlayers.length).toString()));
            this.playersInRound.push(elligiblePlayers[random].name);
            if (this.playersInRound.length == this.players.length) {
                console.log("round done");
                this.playersInRound = [];
            }
            return elligiblePlayers[random];
        }
    };
    //trouver un ami pour demander une question, code beurk
    RoundDataProvider.prototype.getRandomFriend = function (player) {
        var friends = [];
        player.team.players.forEach(function (p) {
            if (p.name != player.name) {
                friends.push(p);
            }
        });
        var index = Math.floor(Math.random() * friends.length);
        if (index > 0) {
            return friends[index].name;
        }
        else {
            return friends[0].name;
        }
    };
    RoundDataProvider.prototype.speak = function (text) {
        var _this = this;
        this.isSpeaking = true;
        var speakOptions = {
            text: text,
            speakRate: 0.5,
            pitch: 1,
            queue: true,
            finishedCallback: (function () {
                _this.isSpeaking = false;
            })
        };
        this.TTS.speak(speakOptions);
    };
    RoundDataProvider.prototype.stopSpeaking = function () {
        this.isSpeaking = false;
        this.TTS.destroy();
    };
    RoundDataProvider.prototype.calculateTeamCount = function () {
        var teamCount = 0;
        if ((this.players.length % 2 == 0 || this.players.length % 3 == 0) && this.players.length > 3) {
            //team creation of 2 or 3 player is possible
            if (this.players.length % 3 == 0) {
                //teams of 3 will be created
                teamCount = this.players.length / 3;
            }
            else {
                //teams of 2 will be created
                teamCount = this.players.length / 2;
            }
            return teamCount;
        }
        else {
            // no team creation is possible
            return 0;
        }
    };
    RoundDataProvider.prototype.getProgress = function () {
        var questionsAnswered = 0;
        this.players.forEach(function (player) {
            questionsAnswered += player.answerCount;
        });
        return (questionsAnswered / (this.answerCount * this.players.length)) * 100;
    };
    RoundDataProvider.prototype.getPlayersInTeam = function (team) {
        return team.players;
    };
    RoundDataProvider.prototype.getExistingAndRemainingPlayers = function (team) {
        var noTeamPlayers = [];
        var j = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].team == null /*|| this.players[i].team == team*/) {
                noTeamPlayers[j] = this.players[i];
                j++;
            }
            else if (this.players[i].team.name == team.name) {
                this.players[i].isSelected = true;
                noTeamPlayers[j] = this.players[i];
                j++;
            }
        }
        return noTeamPlayers;
    };
    RoundDataProvider.prototype.defineQuestionAsker = function () {
        this.questionAsker;
        return this.questionAsker;
    };
    RoundDataProvider.prototype.clearData = function () {
        console.log("Clearing Data...");
        this.triviaQuestion = null;
        this.currentPlayer = null;
        this.group = null;
        for (var i = 0; i < this.players.length; i++) {
            delete this.players[i];
        }
        for (var i = 0; i < this.teams.length; i++) {
            delete this.teams[i];
        }
        this.players = [];
        this.teams = [];
        this.subjectId = "";
        this.gameMode = "";
    };
    RoundDataProvider.prototype.clearGroups = function () {
        for (var i = 0; i < this.groups.length; i++) {
            delete this.groups[i];
        }
        this.groups = [];
    };
    RoundDataProvider.prototype.saveGroups = function () {
        console.log("Saving groups...");
        var str = JSON.stringify(this.groups, null, 4);
        var folderName = "data";
        var fileName = "data.json";
        var documents = file_system_1.knownFolders.documents();
        var folder = documents.getFolder(folderName);
        var file = folder.getFile(fileName);
        file.writeText(str)
            .then(function (result) {
            file.readText()
                .then(function (res) {
                var successMessage = "Successfully saved in " + file.path;
                console.log(successMessage);
                console.log(": " + res);
            });
        }).catch(function (err) {
            console.log(err);
        });
    };
    RoundDataProvider.prototype.loadGroups = function () {
        var _this = this;
        console.log("Loading groups...");
        return new Promise(function (resolve, reject) {
            _this.clearGroups();
            var folderName = "data";
            var fileName = "data.json";
            var documents = file_system_1.knownFolders.documents();
            var folder = documents.getFolder(folderName);
            var file = folder.getFile(fileName);
            file.readText().then(function (res) {
                var writtenContent = res;
                console.log("Successful Read: " + writtenContent);
                var data = JSON.parse(writtenContent);
                console.log("length: " + data.length);
                for (var i = 0; i < data.length; i++) {
                    _this.groups.push(data[i]);
                }
                resolve(writtenContent);
            }).catch(function (err) {
                console.log(err.stack);
                reject(err);
            });
        });
    };
    RoundDataProvider = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], RoundDataProvider);
    return RoundDataProvider;
}());
exports.RoundDataProvider = RoundDataProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmREYXRhLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91bmREYXRhLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLHVFQUEwRTtBQUMxRSxJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMscUJBQXFCLENBQUMsQ0FBQztBQUM1QywyQ0FBeUQ7QUFXekQ7SUFtQ0k7UUE1Qk8sWUFBTyxHQUFjLEVBQUUsQ0FBQztRQUN4QixXQUFNLEdBQWEsRUFBRSxDQUFDO1FBQ3RCLFVBQUssR0FBWSxFQUFFLENBQUM7UUFDcEIsaUJBQVksR0FBWSxLQUFLLENBQUM7UUFZNUIsZ0JBQVcsR0FBVSxDQUFDLENBQUM7UUFFekIsbUJBQWMsR0FBYSxFQUFFLENBQUE7UUFJN0IseUJBQW9CLEdBQVksS0FBSyxDQUFDO1FBRTdDLDRFQUE0RTtRQUM1RSxlQUFVLEdBQVksS0FBSyxDQUFDO1FBUXJCLHdCQUFtQixHQUFZLElBQUksQ0FBQztRQUh2QyxJQUFJLENBQUMsR0FBRyxHQUFHLElBQUksMkNBQWUsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFJRCxpRUFBaUU7SUFDakUsd0VBQXdFO0lBQ2pFLDJDQUFlLEdBQXRCLFVBQXVCLGFBQWE7UUFDaEMsSUFBSSxnQkFBZ0IsR0FBYyxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1Ysa0NBQWtDO1FBQ2xDLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUE7UUFDckQsR0FBRyxDQUFBLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRSxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUUsRUFBQyxDQUFDO1lBQ3ZDLEVBQUUsQ0FBQSxDQUFDLElBQUksQ0FBQyxPQUFP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LGNBQWMsQ0FBQyxDQUFDO2dCQUNqRCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUN0QyxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsR0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBRXBDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBQyxDQUFDLEVBQUUsRUFBRSxDQUFDO29CQUNqQyxLQUFJLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDOUIsQ0FBQztnQkFFRCxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7WUFFNUIsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQUEsR0FBRztnQkFDUixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztnQkFDdkIsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ2hCLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFFTCxDQUFDO0lBaFFVLGlCQUFpQjtRQUQ3QixpQkFBVSxFQUFFOztPQUNBLGlCQUFpQixDQW9RN0I7SUFBRCx3QkFBQztDQUFBLEFBcFFELElBb1FDO0FBcFFZLDhDQUFpQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFROU1RleHRUb1NwZWVjaCwgU3BlYWtPcHRpb25zIH0gZnJvbSAnbmF0aXZlc2NyaXB0LXRleHR0b3NwZWVjaCc7XG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XG5pbXBvcnQgeyBrbm93bkZvbGRlcnMsIEZpbGUsIEZvbGRlciB9IGZyb20gXCJmaWxlLXN5c3RlbVwiO1xuXG5cbmltcG9ydCB7VHJpdmlhUXVlc3Rpb259IGZyb20gXCIuLi90cml2aWFRdWVzdGlvblwiO1xuaW1wb3J0IHtUZWFtfSBmcm9tIFwiLi4vdGVhbVwiO1xuaW1wb3J0IHtQbGF5ZXJ9IGZyb20gXCIuLi9wbGF5ZXJcIjtcbmltcG9ydCB7R3JvdXB9IGZyb20gXCIuLi9ncm91cFwiO1xuXG5cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIFJvdW5kRGF0YVByb3ZpZGVyIHtcbiAgICBcbiAgICBwdWJsaWMgdHJpdmlhUXVlc3Rpb246IFRyaXZpYVF1ZXN0aW9uO1xuICAgIHB1YmxpYyBjdXJyZW50UGxheWVyOiBQbGF5ZXI7XG4gICAgcHVibGljIHF1ZXN0aW9uQXNrZXI6IFBsYXllcjtcbiAgICBcbiAgICBwdWJsaWMgZ3JvdXA6IEdyb3VwO1xuICAgIHB1YmxpYyBwbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICBwdWJsaWMgZ3JvdXBzIDogR3JvdXBbXSA9IFtdOyAgICBcbiAgICBwdWJsaWMgdGVhbXMgOiBUZWFtW10gPSBbXTtcbiAgICBwdWJsaWMgaGFzUXVlc3Rpb25zOiBib29sZWFuID0gZmFsc2U7XG4gICAgcHVibGljIHBhdGg6IHN0cmluZztcbiAgICBwdWJsaWMgcXVlc3Rpb25zOnN0cmluZ1tdO1xuICAgIHB1YmxpYyBhbnN3ZXJzOltzdHJpbmdbXV07XG4gICAgcHVibGljIHN1YmplY3RJZDogc3RyaW5nO1xuICAgIHB1YmxpYyBzdWJqZWN0TmFtZTogc3RyaW5nO1xuICAgIHB1YmxpYyBjYXRlZ29yeTpzdHJpbmc7XG4gICAgcHVibGljIHR5cGU6c3RyaW5nO1xuICAgIHB1YmxpYyBkaWZmaWN1bHR5OnN0cmluZztcbiAgICBcbiAgICBwdWJsaWMgZ2FtZU1vZGU6IHN0cmluZztcbiAgICBcbiAgICByZWFkb25seSBhbnN3ZXJDb3VudDpudW1iZXIgPSAyO1xuXG4gICAgcHVibGljIHBsYXllcnNJblJvdW5kOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgcHJpdmF0ZSBkYXRhYmFzZTogYW55O1xuXG4gICAgcHVibGljIGdyb3VwRmV0Y2hfY29tcGxldGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICAvL3NldCBhIGRlZmF1bHQgYm9vbGVhbiBmb3IgYSBidXR0b24gdG8gYW5pbWF0ZSB3aGVuIHRoZSB0dHMgcGx1Z2luICdzcGVha3MnXG4gICAgaXNTcGVha2luZzogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHByaXZhdGUgVFRTOiBUTlNUZXh0VG9TcGVlY2g7XG4gICAgXG4gICAgXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlRUUyA9IG5ldyBUTlNUZXh0VG9TcGVlY2goKTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGhhc1JlbWFpbmluZ1BsYXllcnM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLy8gUmV0dXJuIGEgcGxheWVyIHRoYXQgaGF2ZW4ndCBwbGF5ZWQgbW9yZSB0aGFuIGF1dGhvcml6ZXMgdGltZXNcbiAgICAvLyBSZXR1cm5zIG51bGwgaWYgbm8gZWxsaWdpYmxlIHBsYXllci4gSGVuY2UgbmVlZCB0byBnbyB0byBzdW1tYXJ5IHBhZ2VcbiAgICBwdWJsaWMgZ2V0UmFuZG9tUGxheWVyKHF1ZXN0aW9uQXNrZXIpe1xuICAgICAgICB2YXIgZWxsaWdpYmxlUGxheWVycyA6IFBsYXllcltdID0gW107XG4gICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgbGV0IGsgPSAwO1xuICAgICAgICAvL3BvcHVsYXRlIGVsbGlnaWJsZSBwbGF5ZXJzIGFycmF5XG4gICAgICAgIGNvbnNvbGUubG9nKFwicXVlc3Rpb24gYXNrZXI6IFwiLmNvbmNhdChxdWVzdGlvbkFza2VyKSlcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5wbGF5ZXJzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzW2ldLmFuc3dlckNvdW50PHRoaXMuYW5zd2VyQ291bnQpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicXVlc3Rpb24gYXNrZXI6IFwiLmNvbmNhdCh0aGlzLnBsYXllcnNbaV0ubmFtZSkpXG4gICAgICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzW2ldLm5hbWUgIT0gcXVlc3Rpb25Bc2tlciAmJiB0aGlzLnBsYXllcnNJblJvdW5kLmluZGV4T2YodGhpcy5wbGF5ZXJzW2ldLm5hbWUpIDwgMCAmJiAodGhpcy5jdXJyZW50UGxheWVyID09IG51bGwgfHwgdGhpcy5wbGF5ZXJzW2ldLm5hbWUgIT0gdGhpcy5jdXJyZW50UGxheWVyLm5hbWUpKXtcbiAgICAgICAgICAgICAgICAgICAgZWxsaWdpYmxlUGxheWVyc1trXT10aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIGsrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmKGogPT0gMCl7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICB0aGlzLmhhc1JlbWFpbmluZ1BsYXllcnMgPSBqID4gMTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGogPiAxKVxuICAgICAgICAgICAgbGV0IHJhbmRvbSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGspOyBcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmFuZG9tIFwiLmNvbmNhdCgocmFuZG9tKS50b1N0cmluZygpKSlcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZWxsaWdpYmxlIFwiLmNvbmNhdCgoZWxsaWdpYmxlUGxheWVycy5sZW5ndGgpLnRvU3RyaW5nKCkpKVxuICAgICAgICAgICAgdGhpcy5wbGF5ZXJzSW5Sb3VuZC5wdXNoKGVsbGlnaWJsZVBsYXllcnNbcmFuZG9tXS5uYW1lKVxuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzSW5Sb3VuZC5sZW5ndGggPT0gdGhpcy5wbGF5ZXJzLmxlbmd0aCl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyb3VuZCBkb25lXCIpXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzSW5Sb3VuZCA9IFtdXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZWxsaWdpYmxlUGxheWVyc1tyYW5kb21dO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy90cm91dmVyIHVuIGFtaSBwb3VyIGRlbWFuZGVyIHVuZSBxdWVzdGlvbiwgY29kZSBiZXVya1xuICAgIHB1YmxpYyBnZXRSYW5kb21GcmllbmQocGxheWVyOiBQbGF5ZXIpe1xuICAgICAgICBsZXQgZnJpZW5kcyA9IFtdO1xuICAgICAgICBwbGF5ZXIudGVhbS5wbGF5ZXJzLmZvckVhY2gocCA9PiB7XG4gICAgICAgICAgICBpZihwLm5hbWUgIT0gcGxheWVyLm5hbWUpe1xuICAgICAgICAgICAgICAgIGZyaWVuZHMucHVzaChwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGxldCBpbmRleCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSpmcmllbmRzLmxlbmd0aCk7XG4gICAgICAgIGlmKGluZGV4ID4gMCl7XG4gICAgICAgICAgICByZXR1cm4gZnJpZW5kc1tpbmRleF0ubmFtZTtcbiAgICAgICAgfSBlbHNle1xuICAgICAgICAgICAgcmV0dXJuIGZyaWVuZHNbMF0ubmFtZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyBzcGVhayh0ZXh0OiBzdHJpbmcpe1xuICAgICAgICB0aGlzLmlzU3BlYWtpbmcgPSB0cnVlO1xuICAgICAgICBsZXQgc3BlYWtPcHRpb25zOiBTcGVha09wdGlvbnMgPSB7XG4gICAgICAgICAgICB0ZXh0OiB0ZXh0LFxuICAgICAgICAgICAgc3BlYWtSYXRlOiAwLjUsXG4gICAgICAgICAgICBwaXRjaDogMSxcbiAgICAgICAgICAgIHF1ZXVlOiB0cnVlLFxuICAgICAgICAgICAgZmluaXNoZWRDYWxsYmFjazogKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLmlzU3BlYWtpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pICBcbiAgICAgICAgfVxuICAgICAgICB0aGlzLlRUUy5zcGVhayhzcGVha09wdGlvbnMpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdG9wU3BlYWtpbmcoKXtcbiAgICAgICAgdGhpcy5pc1NwZWFraW5nID0gZmFsc2U7XG4gICAgICAgIHRoaXMuVFRTLmRlc3Ryb3koKTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGNhbGN1bGF0ZVRlYW1Db3VudCgpe1xuICAgICAgICBsZXQgdGVhbUNvdW50ID0gMDtcbiAgICAgICAgaWYoICh0aGlzLnBsYXllcnMubGVuZ3RoJTIgPT0gMCB8fCB0aGlzLnBsYXllcnMubGVuZ3RoJTMgPT0gMCApICYmIHRoaXMucGxheWVycy5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICAvL3RlYW0gY3JlYXRpb24gb2YgMiBvciAzIHBsYXllciBpcyBwb3NzaWJsZVxuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzLmxlbmd0aCUzID09IDAgKXtcbiAgICAgICAgICAgICAgICAvL3RlYW1zIG9mIDMgd2lsbCBiZSBjcmVhdGVkXG4gICAgICAgICAgICAgICAgdGVhbUNvdW50ID0gdGhpcy5wbGF5ZXJzLmxlbmd0aC8zO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgLy90ZWFtcyBvZiAyIHdpbGwgYmUgY3JlYXRlZFxuICAgICAgICAgICAgICAgIHRlYW1Db3VudCA9IHRoaXMucGxheWVycy5sZW5ndGgvMjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0ZWFtQ291bnQ7XG4gICAgICAgICAgICBcbiAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAvLyBubyB0ZWFtIGNyZWF0aW9uIGlzIHBvc3NpYmxlXG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UHJvZ3Jlc3MoKXtcbiAgICAgICAgdmFyIHF1ZXN0aW9uc0Fuc3dlcmVkIDogbnVtYmVyID0gMDtcbiAgICAgICAgdGhpcy5wbGF5ZXJzLmZvckVhY2gocGxheWVyID0+e1xuICAgICAgICAgICAgcXVlc3Rpb25zQW5zd2VyZWQgKz0gcGxheWVyLmFuc3dlckNvdW50O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIChxdWVzdGlvbnNBbnN3ZXJlZC8odGhpcy5hbnN3ZXJDb3VudCAqIHRoaXMucGxheWVycy5sZW5ndGgpKSAqIDEwMDtcbiAgICB9XG5cbiAgICBwdWJsaWMgZ2V0UGxheWVyc0luVGVhbSh0ZWFtOiBUZWFtKTogUGxheWVyW117XG4gICAgICAgIHJldHVybiB0ZWFtLnBsYXllcnM7XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBnZXRFeGlzdGluZ0FuZFJlbWFpbmluZ1BsYXllcnModGVhbTogVGVhbSk6IFBsYXllcltde1xuICAgICAgICB2YXIgbm9UZWFtUGxheWVycyA6IFBsYXllcltdID0gW107XG4gICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgXG4gICAgICAgIC8vcG9wdWxhdGUgZWxsaWdpYmxlIHBsYXllcnMgYXJyYXlcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5wbGF5ZXJzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzW2ldLnRlYW0gPT0gbnVsbCAvKnx8IHRoaXMucGxheWVyc1tpXS50ZWFtID09IHRlYW0qLyApe1xuICAgICAgICAgICAgICAgIG5vVGVhbVBsYXllcnNbal09dGhpcy5wbGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH0gZWxzZSBpZih0aGlzLnBsYXllcnNbaV0udGVhbS5uYW1lID09ICB0ZWFtLm5hbWUpe1xuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyc1tpXS5pc1NlbGVjdGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBub1RlYW1QbGF5ZXJzW2pdPXRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiBub1RlYW1QbGF5ZXJzO1xuICAgIH1cblxuICAgIHB1YmxpYyBkZWZpbmVRdWVzdGlvbkFza2VyKCl7XG5cbiAgICAgICAgdGhpcy5xdWVzdGlvbkFza2VyO1xuXG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXN0aW9uQXNrZXI7XG4gICAgfVxuICAgIFxuICAgIFxuICAgIHB1YmxpYyBjbGVhckRhdGEoKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJDbGVhcmluZyBEYXRhLi4uXCIpO1xuICAgICAgICB0aGlzLnRyaXZpYVF1ZXN0aW9uID0gbnVsbDsgXG4gICAgICAgIHRoaXMuY3VycmVudFBsYXllcj0gbnVsbDtcbiAgICAgICAgdGhpcy5ncm91cD0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMucGxheWVycy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBsYXllcnNbaV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMudGVhbXMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy50ZWFtc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wbGF5ZXJzPSBbXTtcbiAgICAgICAgdGhpcy50ZWFtcz0gW107XG4gICAgICAgIFxuICAgICAgICB0aGlzLnN1YmplY3RJZD0gXCJcIjtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ2FtZU1vZGU9IFwiXCI7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjbGVhckdyb3Vwcygpe1xuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLmdyb3Vwcy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLmdyb3Vwc1tpXTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuZ3JvdXBzPSBbXTtcbiAgICB9XG5cbiAgcHVibGljIHNhdmVHcm91cHMoKXtcbiAgICBjb25zb2xlLmxvZyhcIlNhdmluZyBncm91cHMuLi5cIik7XG4gICAgdmFyIHN0ciA9IEpTT04uc3RyaW5naWZ5KHRoaXMuZ3JvdXBzLCBudWxsLCA0KTtcblxuICAgIGxldCBmb2xkZXJOYW1lID0gXCJkYXRhXCI7XG4gICAgbGV0IGZpbGVOYW1lID0gXCJkYXRhLmpzb25cIjtcblxuICAgIGxldCBkb2N1bWVudHMgPSBrbm93bkZvbGRlcnMuZG9jdW1lbnRzKCk7XG4gICAgbGV0IGZvbGRlciA9IGRvY3VtZW50cy5nZXRGb2xkZXIoZm9sZGVyTmFtZSk7XG4gICAgbGV0IGZpbGUgPSBmb2xkZXIuZ2V0RmlsZShmaWxlTmFtZSk7XG4gIFxuICAgIGZpbGUud3JpdGVUZXh0KHN0cilcbiAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgIGZpbGUucmVhZFRleHQoKVxuICAgICAgICAgICAgICAgIC50aGVuKHJlcyA9PiB7XG4gICAgICAgICAgICAgICAgICAgbGV0IHN1Y2Nlc3NNZXNzYWdlID0gXCJTdWNjZXNzZnVsbHkgc2F2ZWQgaW4gXCIgKyBmaWxlLnBhdGg7XG4gICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coc3VjY2Vzc01lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiOiBcIisgcmVzKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIH0pO1xuICB9XG5cbiAgcHVibGljIGxvYWRHcm91cHMoKTogUHJvbWlzZSA8YW55PiB7XG4gICAgY29uc29sZS5sb2coXCJMb2FkaW5nIGdyb3Vwcy4uLlwiKTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSxyZWplY3QpID0+IHtcblxuICAgICAgICB0aGlzLmNsZWFyR3JvdXBzKCk7XG4gICAgICAgIFxuICAgICAgICBsZXQgZm9sZGVyTmFtZSA9IFwiZGF0YVwiO1xuICAgICAgICBsZXQgZmlsZU5hbWUgPSBcImRhdGEuanNvblwiO1xuICAgICAgICBsZXQgZG9jdW1lbnRzID0ga25vd25Gb2xkZXJzLmRvY3VtZW50cygpO1xuICAgICAgICBsZXQgZm9sZGVyID0gZG9jdW1lbnRzLmdldEZvbGRlcihmb2xkZXJOYW1lKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBmaWxlID0gZm9sZGVyLmdldEZpbGUoZmlsZU5hbWUpO1xuICAgIFxuICAgICAgICBmaWxlLnJlYWRUZXh0KCkudGhlbihyZXMgPT4ge1xuICAgICAgICAgICAgbGV0IHdyaXR0ZW5Db250ZW50ID0gcmVzO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdWNjZXNzZnVsIFJlYWQ6IFwiKyB3cml0dGVuQ29udGVudCk7XG4gICAgICAgICAgICBsZXQgZGF0YSA9IEpTT04ucGFyc2Uod3JpdHRlbkNvbnRlbnQpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJsZW5ndGg6IFwiK2RhdGEubGVuZ3RoKTtcbiAgICBcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwO2kgPCBkYXRhLmxlbmd0aDtpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwcy5wdXNoKGRhdGFbaV0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNvbHZlKHdyaXR0ZW5Db250ZW50KTtcbiAgICBcbiAgICAgICAgfSkuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVyci5zdGFjayk7XG4gICAgICAgICAgICByZWplY3QoZXJyKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG5cbiAgfVxuICAgIFxuICBcblxufSJdfQ==