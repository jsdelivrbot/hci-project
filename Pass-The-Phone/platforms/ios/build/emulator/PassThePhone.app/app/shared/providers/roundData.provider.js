"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Sqlite = require("nativescript-sqlite");
var RoundDataProvider = /** @class */ (function () {
    function RoundDataProvider() {
        var _this = this;
        this.players = [];
        this.groups = [];
        this.teams = [];
        this.answerCount = 2;
        this.playersInRound = [];
        this.hasRemainingPlayers = true;
        (new Sqlite("passthephone.db")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS players (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, group_id TEXT)").then(function (id) {
                _this.database = db;
            }, function (error) {
                console.log("CREATE TABLE ERROR", error);
            });
        }, function (error) {
            console.log("OPEN DB ERROR", error);
        });
        (new Sqlite("passthephone.db")).then(function (db) {
            db.execSQL("CREATE TABLE IF NOT EXISTS groups (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)").then(function (id) {
                _this.database = db;
            }, function (error) {
                console.log("CREATE TABLE ERROR", error);
            });
        }, function (error) {
            console.log("OPEN DB ERROR", error);
        });
    }
    // Return a player that haven't played more than authorizes times
    // Returns null if no elligible player. Hence need to go to summary page
    RoundDataProvider.prototype.getRandomPlayer = function () {
        var elligiblePlayers = [];
        var j = 0;
        var k = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].answerCount < this.answerCount) {
                if (this.playersInRound.indexOf(this.players[i].name) < 0 && (this.currentPlayer == null || this.players[i].name != this.currentPlayer.name)) {
                    elligiblePlayers[k] = this.players[i];
                    k++;
                }
                j++;
            }
        }
        if (j == 0) {
            return null;
        }
        else {
            this.hasRemainingPlayers = j > 1;
            console.log(j > 1);
            var random = Math.floor(Math.random() * k);
            this.playersInRound.push(elligiblePlayers[random].name);
            if (this.playersInRound.length == this.players.length) {
                console.log("round done");
                this.playersInRound = [];
            }
            return elligiblePlayers[random];
        }
    };
    RoundDataProvider.prototype.calculateTeamCount = function () {
        var teamCount = 0;
        if ((this.players.length % 2 == 0 || this.players.length % 3 == 0) && this.players.length > 3) {
            //team creation of 2 or 3 player is possible
            if (this.players.length % 3 == 0) {
                //teams of 3 will be created
                teamCount = this.players.length / 3;
            }
            else {
                //teams of 2 will be created
                teamCount = this.players.length / 2;
            }
            return teamCount;
        }
        else {
            // no team creation is possible
            return 0;
        }
    };
    RoundDataProvider.prototype.getPlayersInTeam = function (team) {
        return team.players;
    };
    RoundDataProvider.prototype.getExistingAndRemainingPlayers = function (team) {
        var noTeamPlayers = [];
        var j = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].team == null /*|| this.players[i].team == team*/) {
                noTeamPlayers[j] = this.players[i];
                j++;
            }
            else if (this.players[i].team.name == team.name) {
                this.players[i].isSelected = true;
                noTeamPlayers[j] = this.players[i];
                j++;
            }
        }
        return noTeamPlayers;
    };
    RoundDataProvider.prototype.clearData = function () {
        console.log("Clearing Data...");
        this.triviaQuestion = null;
        this.currentPlayer = null;
        this.group = null;
        for (var i = 0; i < this.players.length; i++) {
            delete this.players[i];
        }
        for (var i = 0; i < this.teams.length; i++) {
            delete this.teams[i];
        }
        this.players = [];
        this.teams = [];
        this.subjectId = "";
        this.gameMode = "";
    };
    RoundDataProvider.prototype.clearGroups = function () {
        for (var i = 0; i < this.groups.length; i++) {
            delete this.groups[i];
        }
        this.groups = [];
    };
    RoundDataProvider.prototype.insert_group = function (group) {
        var _this = this;
        this.database.execSQL("INSERT INTO groups (name) VALUES (?)", [group.name]).then(function (id) {
            console.log("INSERT RESULT", id);
            group.id = id;
            // this.fetch();
            _this.insert_group_players(group);
        }, function (error) {
            console.log("INSERT ERROR", error);
        });
    };
    RoundDataProvider.prototype.insert_group_players = function (group) {
        var insert_players = group.players;
        for (var _i = 0, insert_players_1 = insert_players; _i < insert_players_1.length; _i++) {
            var player = insert_players_1[_i];
            this.database.execSQL("INSERT INTO players (name, group_id) VALUES (?, ?)", [player.name, group.id]).then(function (id) {
                console.log("INSERT RESULT", id);
                // this.fetch();
            }, function (error) {
                console.log("INSERT ERROR", error);
            });
        }
    };
    RoundDataProvider.prototype.fetch_groups = function () {
        //TODO. Fetch recostructs objects based on id.
        var _this = this;
        console.log("fetching groups...");
        // var that = this;
        this.database.all("SELECT * FROM groups").then(function (rows) {
            _this.groups = [];
            for (var row in rows) {
                _this.groups.push({
                    "id": rows[row][0],
                    "name": rows[row][1],
                    "playersName": "",
                    "players": null
                });
                var lastGroup = _this.groups[_this.groups.length - 1];
                console.log("new group: " + lastGroup.name);
                lastGroup.players = _this.fetch_group_players(lastGroup);
            }
        }, function (error) {
            console.log("SELECT ERROR", error);
            return false;
        });
        return true;
    };
    RoundDataProvider.prototype.fetch_group_players = function (group) {
        var group_players = [];
        console.log("Fetching group players: " + group.id);
        this.database.all("SELECT * FROM players where id = 1").then(function (rows) {
            group_players = [];
            for (var row in rows) {
                group_players.push({
                    "id": rows[row][0],
                    "name": rows[row][1],
                    "answerCount": 0,
                    "runningPointsTotal": 0,
                    "team": null,
                    "isSelected": false
                });
            }
        }, function (error) {
            console.log("SELECT ERROR", error);
        });
        return group_players;
    };
    RoundDataProvider = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], RoundDataProvider);
    return RoundDataProvider;
}());
exports.RoundDataProvider = RoundDataProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmREYXRhLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91bmREYXRhLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBUTVDO0lBc0JJO1FBQUEsaUJBb0JDO1FBckNNLFlBQU8sR0FBYyxFQUFFLENBQUM7UUFDeEIsV0FBTSxHQUFhLEVBQUUsQ0FBQztRQUN0QixVQUFLLEdBQVksRUFBRSxDQUFDO1FBUWxCLGdCQUFXLEdBQVUsQ0FBQyxDQUFDO1FBRXpCLG1CQUFjLEdBQWEsRUFBRSxDQUFBO1FBMkI3Qix3QkFBbUIsR0FBWSxJQUFJLENBQUM7UUFyQnZDLENBQUMsSUFBSSxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7WUFDbkMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxxR0FBcUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7Z0JBQ3JILEtBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1lBQ3ZCLENBQUMsRUFBRSxVQUFBLEtBQUs7Z0JBQ0osT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUM3QyxDQUFDLENBQUMsQ0FBQztRQUNQLENBQUMsRUFBRSxVQUFBLEtBQUs7WUFDSixPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUN4QyxDQUFDLENBQUMsQ0FBQztRQUVILENBQUMsSUFBSSxNQUFNLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7WUFDbkMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxxRkFBcUYsQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFBLEVBQUU7Z0JBQ3JHLEtBQUksQ0FBQyxRQUFRLEdBQUcsRUFBRSxDQUFDO1lB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amVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbnZhciBTcWxpdGUgPSByZXF1aXJlKFwibmF0aXZlc2NyaXB0LXNxbGl0ZVwiKTtcblxuaW1wb3J0IHtUcml2aWFRdWVzdGlvbn0gZnJvbSBcIi4uL3RyaXZpYVF1ZXN0aW9uXCI7XG5pbXBvcnQge1RlYW19IGZyb20gXCIuLi90ZWFtXCI7XG5pbXBvcnQge1BsYXllcn0gZnJvbSBcIi4uL3BsYXllclwiO1xuaW1wb3J0IHtHcm91cH0gZnJvbSBcIi4uL2dyb3VwXCI7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBSb3VuZERhdGFQcm92aWRlciB7XG4gICAgXG4gICAgcHVibGljIHRyaXZpYVF1ZXN0aW9uOiBUcml2aWFRdWVzdGlvbjtcbiAgICBwdWJsaWMgY3VycmVudFBsYXllcjogUGxheWVyO1xuICAgIHB1YmxpYyBncm91cDogR3JvdXA7XG4gICAgcHVibGljIHBsYXllcnMgOiBQbGF5ZXJbXSA9IFtdO1xuICAgIHB1YmxpYyBncm91cHMgOiBHcm91cFtdID0gW107ICAgIFxuICAgIHB1YmxpYyB0ZWFtcyA6IFRlYW1bXSA9IFtdO1xuICAgIFxuICAgIHB1YmxpYyBwYXRoOiBzdHJpbmc7XG4gICAgXG4gICAgcHVibGljIHN1YmplY3RJZDogc3RyaW5nO1xuICAgIFxuICAgIHB1YmxpYyBnYW1lTW9kZTogc3RyaW5nO1xuICAgIFxuICAgIHJlYWRvbmx5IGFuc3dlckNvdW50Om51bWJlciA9IDI7XG5cbiAgICBwdWJsaWMgcGxheWVyc0luUm91bmQ6IHN0cmluZ1tdID0gW11cbiAgICBcbiAgICBwcml2YXRlIGRhdGFiYXNlOiBhbnk7XG4gICAgXG4gICAgXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAobmV3IFNxbGl0ZShcInBhc3N0aGVwaG9uZS5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBkYi5leGVjU1FMKFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcGxheWVycyAoaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULCBuYW1lIFRFWFQsIGdyb3VwX2lkIFRFWFQpXCIpLnRoZW4oaWQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcbiAgICAgICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNSRUFURSBUQUJMRSBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAobmV3IFNxbGl0ZShcInBhc3N0aGVwaG9uZS5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgICAgICBkYi5leGVjU1FMKFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgZ3JvdXBzIChpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsIG5hbWUgVEVYVClcIikudGhlbihpZCA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1JFQVRFIFRBQkxFIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LCBlcnJvciA9PiB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk9QRU4gREIgRVJST1JcIiwgZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGhhc1JlbWFpbmluZ1BsYXllcnM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLy8gUmV0dXJuIGEgcGxheWVyIHRoYXQgaGF2ZW4ndCBwbGF5ZWQgbW9yZSB0aGFuIGF1dGhvcml6ZXMgdGltZXNcbiAgICAvLyBSZXR1cm5zIG51bGwgaWYgbm8gZWxsaWdpYmxlIHBsYXllci4gSGVuY2UgbmVlZCB0byBnbyB0byBzdW1tYXJ5IHBhZ2VcbiAgICBwdWJsaWMgZ2V0UmFuZG9tUGxheWVyKCl7XG4gICAgICAgIHZhciBlbGxpZ2libGVQbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICBsZXQgayA9IDA7XG4gICAgICAgIC8vcG9wdWxhdGUgZWxsaWdpYmxlIHBsYXllcnMgYXJyYXlcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5wbGF5ZXJzLmxlbmd0aDtpKyspe1xuICAgICAgICAgICAgaWYodGhpcy5wbGF5ZXJzW2ldLmFuc3dlckNvdW50PHRoaXMuYW5zd2VyQ291bnQpe1xuICAgICAgICAgICAgICAgIGlmKHRoaXMucGxheWVyc0luUm91bmQuaW5kZXhPZih0aGlzLnBsYXllcnNbaV0ubmFtZSkgPCAwICYmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT0gbnVsbCB8fCB0aGlzLnBsYXllcnNbaV0ubmFtZSAhPSB0aGlzLmN1cnJlbnRQbGF5ZXIubmFtZSkpe1xuICAgICAgICAgICAgICAgICAgICBlbGxpZ2libGVQbGF5ZXJzW2tdPXRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgaysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoaiA9PSAwKXtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuaGFzUmVtYWluaW5nUGxheWVycyA9IGogPiAxO1xuICAgICAgICAgICAgY29uc29sZS5sb2coaiA+IDEpXG4gICAgICAgICAgICBsZXQgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogayk7ICBcbiAgICAgICAgICAgIHRoaXMucGxheWVyc0luUm91bmQucHVzaChlbGxpZ2libGVQbGF5ZXJzW3JhbmRvbV0ubmFtZSlcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVyc0luUm91bmQubGVuZ3RoID09IHRoaXMucGxheWVycy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicm91bmQgZG9uZVwiKVxuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyc0luUm91bmQgPSBbXVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsbGlnaWJsZVBsYXllcnNbcmFuZG9tXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgY2FsY3VsYXRlVGVhbUNvdW50KCl7XG4gICAgICAgIGxldCB0ZWFtQ291bnQgPSAwO1xuICAgICAgICBpZiggKHRoaXMucGxheWVycy5sZW5ndGglMiA9PSAwIHx8IHRoaXMucGxheWVycy5sZW5ndGglMyA9PSAwICkgJiYgdGhpcy5wbGF5ZXJzLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIC8vdGVhbSBjcmVhdGlvbiBvZiAyIG9yIDMgcGxheWVyIGlzIHBvc3NpYmxlXG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnMubGVuZ3RoJTMgPT0gMCApe1xuICAgICAgICAgICAgICAgIC8vdGVhbXMgb2YgMyB3aWxsIGJlIGNyZWF0ZWRcbiAgICAgICAgICAgICAgICB0ZWFtQ291bnQgPSB0aGlzLnBsYXllcnMubGVuZ3RoLzM7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAvL3RlYW1zIG9mIDIgd2lsbCBiZSBjcmVhdGVkXG4gICAgICAgICAgICAgICAgdGVhbUNvdW50ID0gdGhpcy5wbGF5ZXJzLmxlbmd0aC8yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRlYW1Db3VudDtcbiAgICAgICAgICAgIFxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIG5vIHRlYW0gY3JlYXRpb24gaXMgcG9zc2libGVcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQbGF5ZXJzSW5UZWFtKHRlYW06IFRlYW0pOiBQbGF5ZXJbXXtcbiAgICAgICAgcmV0dXJuIHRlYW0ucGxheWVycztcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGdldEV4aXN0aW5nQW5kUmVtYWluaW5nUGxheWVycyh0ZWFtOiBUZWFtKTogUGxheWVyW117XG4gICAgICAgIHZhciBub1RlYW1QbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICBcbiAgICAgICAgLy9wb3B1bGF0ZSBlbGxpZ2libGUgcGxheWVycyBhcnJheVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLnBsYXllcnMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0udGVhbSA9PSBudWxsIC8qfHwgdGhpcy5wbGF5ZXJzW2ldLnRlYW0gPT0gdGVhbSovICl7XG4gICAgICAgICAgICAgICAgbm9UZWFtUGxheWVyc1tqXT10aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMucGxheWVyc1tpXS50ZWFtLm5hbWUgPT0gIHRlYW0ubmFtZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2ldLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5vVGVhbVBsYXllcnNbal09dGhpcy5wbGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5vVGVhbVBsYXllcnM7XG4gICAgfVxuICAgIFxuICAgIFxuICAgIHB1YmxpYyBjbGVhckRhdGEoKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJDbGVhcmluZyBEYXRhLi4uXCIpO1xuICAgICAgICB0aGlzLnRyaXZpYVF1ZXN0aW9uID0gbnVsbDsgXG4gICAgICAgIHRoaXMuY3VycmVudFBsYXllcj0gbnVsbDtcbiAgICAgICAgdGhpcy5ncm91cD0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMucGxheWVycy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBsYXllcnNbaV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMudGVhbXMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy50ZWFtc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wbGF5ZXJzPSBbXTtcbiAgICAgICAgdGhpcy50ZWFtcz0gW107XG4gICAgICAgIFxuICAgICAgICB0aGlzLnN1YmplY3RJZD0gXCJcIjtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ2FtZU1vZGU9IFwiXCI7XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBjbGVhckdyb3Vwcygpe1xuICAgICAgICBcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5ncm91cHMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5ncm91cHNbaV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ3JvdXBzPSBbXTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGluc2VydF9ncm91cChncm91cDpHcm91cCkgeyAgICAgICAgXG4gICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBJTlRPIGdyb3VwcyAobmFtZSkgVkFMVUVTICg/KVwiLCBbZ3JvdXAubmFtZV0pLnRoZW4oaWQgPT4ge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUXCIsIGlkKTtcbiAgICAgICAgICAgIGdyb3VwLmlkPWlkO1xuICAgICAgICAgICAgLy8gdGhpcy5mZXRjaCgpO1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRfZ3JvdXBfcGxheWVycyhncm91cCk7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHByaXZhdGUgaW5zZXJ0X2dyb3VwX3BsYXllcnMoZ3JvdXA6R3JvdXApIHtcbiAgICAgICAgXG4gICAgICAgIGxldCBpbnNlcnRfcGxheWVycyA9IGdyb3VwLnBsYXllcnM7XG4gICAgICAgIFxuICAgICAgICBmb3IgKHZhciBwbGF5ZXIgb2YgaW5zZXJ0X3BsYXllcnMpe1xuICAgICAgICAgICAgdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gcGxheWVycyAobmFtZSwgZ3JvdXBfaWQpIFZBTFVFUyAoPywgPylcIiwgW3BsYXllci5uYW1lLCBncm91cC5pZF0pLnRoZW4oaWQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIFJFU1VMVFwiLCBpZCk7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5mZXRjaCgpO1xuICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIFxuICAgIHB1YmxpYyBmZXRjaF9ncm91cHMoKSB7XG4gICAgICAgIC8vVE9ETy4gRmV0Y2ggcmVjb3N0cnVjdHMgb2JqZWN0cyBiYXNlZCBvbiBpZC5cbiAgICAgICAgXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZmV0Y2hpbmcgZ3JvdXBzLi4uXCIpO1xuICAgICAgICBcbiAgICAgICAgLy8gdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIGdyb3Vwc1wiKS50aGVuKHJvd3MgPT4ge1xuICAgICAgICAgICAgdGhpcy5ncm91cHMgPSBbXTtcbiAgICAgICAgICAgIGZvcih2YXIgcm93IGluIHJvd3MpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgXCJpZFwiOnJvd3Nbcm93XVswXSxcbiAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6cm93c1tyb3ddWzFdLFxuICAgICAgICAgICAgICAgICAgICBcInBsYXllcnNOYW1lXCI6XCJcIixcbiAgICAgICAgICAgICAgICAgICAgXCJwbGF5ZXJzXCI6bnVsbFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBsZXQgbGFzdEdyb3VwID0gdGhpcy5ncm91cHNbdGhpcy5ncm91cHMubGVuZ3RoLTFdO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJuZXcgZ3JvdXA6IFwiK2xhc3RHcm91cC5uYW1lKTtcbiAgICAgICAgICAgIGxhc3RHcm91cC5wbGF5ZXJzPSB0aGlzLmZldGNoX2dyb3VwX3BsYXllcnMobGFzdEdyb3VwKTtcbiAgICAgICAgfVxuICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coXCJTRUxFQ1QgRVJST1JcIiwgZXJyb3IpO1xuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9KTtcbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxucHVibGljIGZldGNoX2dyb3VwX3BsYXllcnMoZ3JvdXA6R3JvdXApe1xuICAgIGxldCBncm91cF9wbGF5ZXJzOiBQbGF5ZXJbXT1bXTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyhcIkZldGNoaW5nIGdyb3VwIHBsYXllcnM6IFwiK2dyb3VwLmlkKTtcblxuICAgIFxuICAgIHRoaXMuZGF0YWJhc2UuYWxsKFwiU0VMRUNUICogRlJPTSBwbGF5ZXJzIHdoZXJlIGlkID0gMVwiKS50aGVuKHJvd3MgPT4ge1xuICAgICAgICBncm91cF9wbGF5ZXJzID0gW107XG4gICAgICAgIGZvcih2YXIgcm93IGluIHJvd3MpIHtcbiAgICAgICAgICAgIGdyb3VwX3BsYXllcnMucHVzaCh7XG4gICAgICAgICAgICAgICAgXCJpZFwiOnJvd3Nbcm93XVswXSxcbiAgICAgICAgICAgICAgICBcIm5hbWVcIjpyb3dzW3Jvd11bMV0sXG4gICAgICAgICAgICAgICAgXCJhbnN3ZXJDb3VudFwiOiAwLFxuICAgICAgICAgICAgICAgIFwicnVubmluZ1BvaW50c1RvdGFsXCI6IDAsXG4gICAgICAgICAgICAgICAgXCJ0ZWFtXCI6IG51bGwsXG4gICAgICAgICAgICAgICAgXCJpc1NlbGVjdGVkXCI6ZmFsc2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIGdyb3VwX3BsYXllcnM7XG59XG5cbn0iXX0=