"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var Sqlite = require("nativescript-sqlite");
var RoundDataProvider = /** @class */ (function () {
    function RoundDataProvider() {
        // (new Sqlite("passthephone.db")).then(db => {
        //     db.execSQL("CREATE TABLE IF NOT EXISTS players (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, group_id TEXT)").then(id => {
        //         this.database = db;
        //     }, error => {
        //         console.log("CREATE TABLE ERROR", error);
        //     });
        // }, error => {
        //     console.log("OPEN DB ERROR", error);
        // });
        this.players = [];
        this.groups = [];
        this.teams = [];
        this.answerCount = 2;
        this.playersInRound = [];
        this.groupFetch_completed = false;
        this.hasRemainingPlayers = true;
        // (new Sqlite("passthephone.db")).then(db => {
        //     db.execSQL("CREATE TABLE IF NOT EXISTS groups (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT)").then(id => {
        //         this.database = db;
        //     }, error => {
        //         console.log("CREATE TABLE ERROR", error);
        //     });
        // }, error => {
        //     console.log("OPEN DB ERROR", error);
        // });
    }
    // Return a player that haven't played more than authorizes times
    // Returns null if no elligible player. Hence need to go to summary page
    RoundDataProvider.prototype.getRandomPlayer = function (questionAsker) {
        var elligiblePlayers = [];
        var j = 0;
        var k = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].answerCount < this.answerCount) {
                if (this.players[i].name != questionAsker && this.playersInRound.indexOf(this.players[i].name) < 0 && (this.currentPlayer == null || this.players[i].name != this.currentPlayer.name)) {
                    elligiblePlayers[k] = this.players[i];
                    k++;
                }
                j++;
            }
        }
        if (j == 0) {
            return null;
        }
        else {
            this.hasRemainingPlayers = j > 1;
            console.log(j > 1);
            var random = Math.floor(Math.random() * k);
            this.playersInRound.push(elligiblePlayers[random].name);
            if (this.playersInRound.length == this.players.length) {
                console.log("round done");
                this.playersInRound = [];
            }
            return elligiblePlayers[random];
        }
    };
    RoundDataProvider.prototype.calculateTeamCount = function () {
        var teamCount = 0;
        if ((this.players.length % 2 == 0 || this.players.length % 3 == 0) && this.players.length > 3) {
            //team creation of 2 or 3 player is possible
            if (this.players.length % 3 == 0) {
                //teams of 3 will be created
                teamCount = this.players.length / 3;
            }
            else {
                //teams of 2 will be created
                teamCount = this.players.length / 2;
            }
            return teamCount;
        }
        else {
            // no team creation is possible
            return 0;
        }
    };
    RoundDataProvider.prototype.getPlayersInTeam = function (team) {
        return team.players;
    };
    RoundDataProvider.prototype.getExistingAndRemainingPlayers = function (team) {
        var noTeamPlayers = [];
        var j = 0;
        //populate elligible players array
        for (var i = 0; i < this.players.length; i++) {
            if (this.players[i].team == null /*|| this.players[i].team == team*/) {
                noTeamPlayers[j] = this.players[i];
                j++;
            }
            else if (this.players[i].team.name == team.name) {
                this.players[i].isSelected = true;
                noTeamPlayers[j] = this.players[i];
                j++;
            }
        }
        return noTeamPlayers;
    };
    RoundDataProvider.prototype.clearData = function () {
        console.log("Clearing Data...");
        this.triviaQuestion = null;
        this.currentPlayer = null;
        this.group = null;
        for (var i = 0; i < this.players.length; i++) {
            delete this.players[i];
        }
        for (var i = 0; i < this.teams.length; i++) {
            delete this.teams[i];
        }
        this.players = [];
        this.teams = [];
        this.subjectId = "";
        this.gameMode = "";
    };
    RoundDataProvider = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [])
    ], RoundDataProvider);
    return RoundDataProvider;
}());
exports.RoundDataProvider = RoundDataProvider;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91bmREYXRhLnByb3ZpZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsicm91bmREYXRhLnByb3ZpZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQTJDO0FBQzNDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBUTVDO0lBd0JJO1FBQ0ksK0NBQStDO1FBQy9DLHFJQUFxSTtRQUNySSw4QkFBOEI7UUFDOUIsb0JBQW9CO1FBQ3BCLG9EQUFvRDtRQUNwRCxVQUFVO1FBQ1YsZ0JBQWdCO1FBQ2hCLDJDQUEyQztRQUMzQyxNQUFNO1FBNUJILFlBQU8sR0FBYyxFQUFFLENBQUM7UUFDeEIsV0FBTSxHQUFhLEVBQUUsQ0FBQztRQUN0QixVQUFLLEdBQVksRUFBRSxDQUFDO1FBUWxCLGdCQUFXLEdBQVUsQ0FBQyxDQUFDO1FBRXpCLG1CQUFjLEdBQWEsRUFBRSxDQUFBO1FBSTdCLHlCQUFvQixHQUFZLEtBQUssQ0FBQztRQXlCdEMsd0JBQW1CLEdBQVksSUFBSSxDQUFDO1FBWHZDLCtDQUErQztRQUMvQyxxSEFBcUg7UUFDckgsOEJBQThCO1FBQzlCLG9CQUFvQjtRQUNwQixvREFBb0Q7UUFDcEQsVUFBVTtRQUNWLGdCQUFnQjtRQUNoQiwyQ0FBMkM7UUFDM0MsTUFBTTtJQUNWLENBQUM7SUFJRCxpRUFBaUU7SUFDakUsd0VBQXdFO0lBQ2pFLDJDQUFlLEdBQXRCLFVBQXVCLGFBQWE7UUFDaEMsSUFBSSxnQkFBZ0IsR0FBYyxFQUFFLENBQUM7UUFDckMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1Ysa0NBQWtDO1FBQ2xDLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQztZQUN2QyxFQUFFLENBQUEsQ0FB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SUFBSSxDQUFDO1FBRWpCLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQztZQUN2QyxPQUFPLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsQ0FBQztRQUVELEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUMsQ0FBQyxFQUFFLEVBQUMsQ0FBQztZQUNyQyxPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDekIsQ0FBQztRQUVELElBQUksQ0FBQyxPQUFPLEdBQUUsRUFBRSxDQUFDO1FBQ2pCLElBQUksQ0FBQyxLQUFLLEdBQUUsRUFBRSxDQUFDO1FBRWYsSUFBSSxDQUFDLFNBQVMsR0FBRSxFQUFFLENBQUM7UUFFbkIsSUFBSSxDQUFDLFFBQVEsR0FBRSxFQUFFLENBQUM7SUFDdEIsQ0FBQztJQS9JUSxpQkFBaUI7UUFEN0IsaUJBQVUsRUFBRTs7T0FDQSxpQkFBaUIsQ0F1TzdCO0lBQUQsd0JBQUM7Q0FBQSxBQXZPRCxJQXVPQztBQXZPWSw4Q0FBaUIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG52YXIgU3FsaXRlID0gcmVxdWlyZShcIm5hdGl2ZXNjcmlwdC1zcWxpdGVcIik7XG5cbmltcG9ydCB7VHJpdmlhUXVlc3Rpb259IGZyb20gXCIuLi90cml2aWFRdWVzdGlvblwiO1xuaW1wb3J0IHtUZWFtfSBmcm9tIFwiLi4vdGVhbVwiO1xuaW1wb3J0IHtQbGF5ZXJ9IGZyb20gXCIuLi9wbGF5ZXJcIjtcbmltcG9ydCB7R3JvdXB9IGZyb20gXCIuLi9ncm91cFwiO1xuXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgY2xhc3MgUm91bmREYXRhUHJvdmlkZXIge1xuICAgIFxuICAgIHB1YmxpYyB0cml2aWFRdWVzdGlvbjogVHJpdmlhUXVlc3Rpb247XG4gICAgcHVibGljIGN1cnJlbnRQbGF5ZXI6IFBsYXllcjtcbiAgICBwdWJsaWMgZ3JvdXA6IEdyb3VwO1xuICAgIHB1YmxpYyBwbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICBwdWJsaWMgZ3JvdXBzIDogR3JvdXBbXSA9IFtdOyAgICBcbiAgICBwdWJsaWMgdGVhbXMgOiBUZWFtW10gPSBbXTtcbiAgICBcbiAgICBwdWJsaWMgcGF0aDogc3RyaW5nO1xuICAgIFxuICAgIHB1YmxpYyBzdWJqZWN0SWQ6IHN0cmluZztcbiAgICBcbiAgICBwdWJsaWMgZ2FtZU1vZGU6IHN0cmluZztcbiAgICBcbiAgICByZWFkb25seSBhbnN3ZXJDb3VudDpudW1iZXIgPSAyO1xuXG4gICAgcHVibGljIHBsYXllcnNJblJvdW5kOiBzdHJpbmdbXSA9IFtdXG4gICAgXG4gICAgcHJpdmF0ZSBkYXRhYmFzZTogYW55O1xuXG4gICAgcHVibGljIGdyb3VwRmV0Y2hfY29tcGxldGVkOiBib29sZWFuID0gZmFsc2U7XG4gICAgXG4gICAgXG4gICAgcHVibGljIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyAobmV3IFNxbGl0ZShcInBhc3N0aGVwaG9uZS5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgIC8vICAgICBkYi5leGVjU1FMKFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgcGxheWVycyAoaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULCBuYW1lIFRFWFQsIGdyb3VwX2lkIFRFWFQpXCIpLnRoZW4oaWQgPT4ge1xuICAgICAgICAvLyAgICAgICAgIHRoaXMuZGF0YWJhc2UgPSBkYjtcbiAgICAgICAgLy8gICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgLy8gICAgICAgICBjb25zb2xlLmxvZyhcIkNSRUFURSBUQUJMRSBFUlJPUlwiLCBlcnJvcik7XG4gICAgICAgIC8vICAgICB9KTtcbiAgICAgICAgLy8gfSwgZXJyb3IgPT4ge1xuICAgICAgICAvLyAgICAgY29uc29sZS5sb2coXCJPUEVOIERCIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgLy8gfSk7XG4gICAgICAgIFxuICAgICAgICAvLyAobmV3IFNxbGl0ZShcInBhc3N0aGVwaG9uZS5kYlwiKSkudGhlbihkYiA9PiB7XG4gICAgICAgIC8vICAgICBkYi5leGVjU1FMKFwiQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgZ3JvdXBzIChpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsIG5hbWUgVEVYVClcIikudGhlbihpZCA9PiB7XG4gICAgICAgIC8vICAgICAgICAgdGhpcy5kYXRhYmFzZSA9IGRiO1xuICAgICAgICAvLyAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICAvLyAgICAgICAgIGNvbnNvbGUubG9nKFwiQ1JFQVRFIFRBQkxFIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgICAgLy8gICAgIH0pO1xuICAgICAgICAvLyB9LCBlcnJvciA9PiB7XG4gICAgICAgIC8vICAgICBjb25zb2xlLmxvZyhcIk9QRU4gREIgRVJST1JcIiwgZXJyb3IpO1xuICAgICAgICAvLyB9KTtcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGhhc1JlbWFpbmluZ1BsYXllcnM6IGJvb2xlYW4gPSB0cnVlO1xuXG4gICAgLy8gUmV0dXJuIGEgcGxheWVyIHRoYXQgaGF2ZW4ndCBwbGF5ZWQgbW9yZSB0aGFuIGF1dGhvcml6ZXMgdGltZXNcbiAgICAvLyBSZXR1cm5zIG51bGwgaWYgbm8gZWxsaWdpYmxlIHBsYXllci4gSGVuY2UgbmVlZCB0byBnbyB0byBzdW1tYXJ5IHBhZ2VcbiAgICBwdWJsaWMgZ2V0UmFuZG9tUGxheWVyKHF1ZXN0aW9uQXNrZXIpe1xuICAgICAgICB2YXIgZWxsaWdpYmxlUGxheWVycyA6IFBsYXllcltdID0gW107XG4gICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgbGV0IGsgPSAwO1xuICAgICAgICAvL3BvcHVsYXRlIGVsbGlnaWJsZSBwbGF5ZXJzIGFycmF5XG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMucGxheWVycy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVyc1tpXS5hbnN3ZXJDb3VudDx0aGlzLmFuc3dlckNvdW50KXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0ubmFtZSAhPSBxdWVzdGlvbkFza2VyICYmIHRoaXMucGxheWVyc0luUm91bmQuaW5kZXhPZih0aGlzLnBsYXllcnNbaV0ubmFtZSkgPCAwICYmICh0aGlzLmN1cnJlbnRQbGF5ZXIgPT0gbnVsbCB8fCB0aGlzLnBsYXllcnNbaV0ubmFtZSAhPSB0aGlzLmN1cnJlbnRQbGF5ZXIubmFtZSkpe1xuICAgICAgICAgICAgICAgICAgICBlbGxpZ2libGVQbGF5ZXJzW2tdPXRoaXMucGxheWVyc1tpXTtcbiAgICAgICAgICAgICAgICAgICAgaysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBqKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYoaiA9PSAwKXtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIHRoaXMuaGFzUmVtYWluaW5nUGxheWVycyA9IGogPiAxO1xuICAgICAgICAgICAgY29uc29sZS5sb2coaiA+IDEpXG4gICAgICAgICAgICBsZXQgcmFuZG9tID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogayk7ICBcbiAgICAgICAgICAgIHRoaXMucGxheWVyc0luUm91bmQucHVzaChlbGxpZ2libGVQbGF5ZXJzW3JhbmRvbV0ubmFtZSlcbiAgICAgICAgICAgIGlmKHRoaXMucGxheWVyc0luUm91bmQubGVuZ3RoID09IHRoaXMucGxheWVycy5sZW5ndGgpe1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicm91bmQgZG9uZVwiKVxuICAgICAgICAgICAgICAgIHRoaXMucGxheWVyc0luUm91bmQgPSBbXVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsbGlnaWJsZVBsYXllcnNbcmFuZG9tXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBcbiAgICBwdWJsaWMgY2FsY3VsYXRlVGVhbUNvdW50KCl7XG4gICAgICAgIGxldCB0ZWFtQ291bnQgPSAwO1xuICAgICAgICBpZiggKHRoaXMucGxheWVycy5sZW5ndGglMiA9PSAwIHx8IHRoaXMucGxheWVycy5sZW5ndGglMyA9PSAwICkgJiYgdGhpcy5wbGF5ZXJzLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgIC8vdGVhbSBjcmVhdGlvbiBvZiAyIG9yIDMgcGxheWVyIGlzIHBvc3NpYmxlXG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnMubGVuZ3RoJTMgPT0gMCApe1xuICAgICAgICAgICAgICAgIC8vdGVhbXMgb2YgMyB3aWxsIGJlIGNyZWF0ZWRcbiAgICAgICAgICAgICAgICB0ZWFtQ291bnQgPSB0aGlzLnBsYXllcnMubGVuZ3RoLzM7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAvL3RlYW1zIG9mIDIgd2lsbCBiZSBjcmVhdGVkXG4gICAgICAgICAgICAgICAgdGVhbUNvdW50ID0gdGhpcy5wbGF5ZXJzLmxlbmd0aC8yO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHRlYW1Db3VudDtcbiAgICAgICAgICAgIFxuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIG5vIHRlYW0gY3JlYXRpb24gaXMgcG9zc2libGVcbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuICAgIHB1YmxpYyBnZXRQbGF5ZXJzSW5UZWFtKHRlYW06IFRlYW0pOiBQbGF5ZXJbXXtcbiAgICAgICAgcmV0dXJuIHRlYW0ucGxheWVycztcbiAgICB9XG4gICAgXG4gICAgcHVibGljIGdldEV4aXN0aW5nQW5kUmVtYWluaW5nUGxheWVycyh0ZWFtOiBUZWFtKTogUGxheWVyW117XG4gICAgICAgIHZhciBub1RlYW1QbGF5ZXJzIDogUGxheWVyW10gPSBbXTtcbiAgICAgICAgbGV0IGogPSAwO1xuICAgICAgICBcbiAgICAgICAgLy9wb3B1bGF0ZSBlbGxpZ2libGUgcGxheWVycyBhcnJheVxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDx0aGlzLnBsYXllcnMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBpZih0aGlzLnBsYXllcnNbaV0udGVhbSA9PSBudWxsIC8qfHwgdGhpcy5wbGF5ZXJzW2ldLnRlYW0gPT0gdGVhbSovICl7XG4gICAgICAgICAgICAgICAgbm9UZWFtUGxheWVyc1tqXT10aGlzLnBsYXllcnNbaV07XG4gICAgICAgICAgICAgICAgaisrO1xuICAgICAgICAgICAgfSBlbHNlIGlmKHRoaXMucGxheWVyc1tpXS50ZWFtLm5hbWUgPT0gIHRlYW0ubmFtZSl7XG4gICAgICAgICAgICAgICAgdGhpcy5wbGF5ZXJzW2ldLmlzU2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIG5vVGVhbVBsYXllcnNbal09dGhpcy5wbGF5ZXJzW2ldO1xuICAgICAgICAgICAgICAgIGorKztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIG5vVGVhbVBsYXllcnM7XG4gICAgfVxuICAgIFxuICAgIFxuICAgIHB1YmxpYyBjbGVhckRhdGEoKXtcbiAgICAgICAgY29uc29sZS5sb2coXCJDbGVhcmluZyBEYXRhLi4uXCIpO1xuICAgICAgICB0aGlzLnRyaXZpYVF1ZXN0aW9uID0gbnVsbDsgXG4gICAgICAgIHRoaXMuY3VycmVudFBsYXllcj0gbnVsbDtcbiAgICAgICAgdGhpcy5ncm91cD0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMucGxheWVycy5sZW5ndGg7aSsrKXtcbiAgICAgICAgICAgIGRlbGV0ZSB0aGlzLnBsYXllcnNbaV07XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPHRoaXMudGVhbXMubGVuZ3RoO2krKyl7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy50ZWFtc1tpXTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgdGhpcy5wbGF5ZXJzPSBbXTtcbiAgICAgICAgdGhpcy50ZWFtcz0gW107XG4gICAgICAgIFxuICAgICAgICB0aGlzLnN1YmplY3RJZD0gXCJcIjtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuZ2FtZU1vZGU9IFwiXCI7XG4gICAgfVxuICAgIFxuICAgIC8vIHB1YmxpYyBjbGVhckdyb3Vwcygpe1xuICAgICAgICBcbiAgICAvLyAgICAgZm9yKGxldCBpID0gMDsgaSA8dGhpcy5ncm91cHMubGVuZ3RoO2krKyl7XG4gICAgLy8gICAgICAgICBkZWxldGUgdGhpcy5ncm91cHNbaV07XG4gICAgLy8gICAgIH1cbiAgICAgICAgXG4gICAgLy8gICAgIHRoaXMuZ3JvdXBzPSBbXTtcbiAgICAvLyB9XG4gICAgXG4vLyAgICAgcHVibGljIGluc2VydF9ncm91cChncm91cDpHcm91cCkgeyAgICAgICAgXG4vLyAgICAgICAgIHRoaXMuZGF0YWJhc2UuZXhlY1NRTChcIklOU0VSVCBJTlRPIGdyb3VwcyAobmFtZSkgVkFMVUVTICg/KVwiLCBbZ3JvdXAubmFtZV0pLnRoZW4oaWQgPT4ge1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJJTlNFUlQgUkVTVUxUXCIsIGlkKTtcbi8vICAgICAgICAgICAgIGdyb3VwLmlkPWlkO1xuLy8gICAgICAgICAgICAgLy8gdGhpcy5mZXRjaCgpO1xuLy8gICAgICAgICAgICAgdGhpcy5pbnNlcnRfZ3JvdXBfcGxheWVycyhncm91cCk7XG4vLyAgICAgICAgIH0sIGVycm9yID0+IHtcbi8vICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SXCIsIGVycm9yKTtcbi8vICAgICAgICAgfSk7XG4vLyAgICAgfVxuICAgIFxuLy8gICAgIHByaXZhdGUgaW5zZXJ0X2dyb3VwX3BsYXllcnMoZ3JvdXA6R3JvdXApIHtcbiAgICAgICAgXG4vLyAgICAgICAgIGxldCBpbnNlcnRfcGxheWVycyA9IGdyb3VwLnBsYXllcnM7XG4gICAgICAgIFxuLy8gICAgICAgICBmb3IgKHZhciBwbGF5ZXIgb2YgaW5zZXJ0X3BsYXllcnMpe1xuLy8gICAgICAgICAgICAgdGhpcy5kYXRhYmFzZS5leGVjU1FMKFwiSU5TRVJUIElOVE8gcGxheWVycyAobmFtZSwgZ3JvdXBfaWQpIFZBTFVFUyAoPywgPylcIiwgW3BsYXllci5uYW1lLCBncm91cC5pZF0pLnRoZW4oaWQgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIFJFU1VMVFwiLCBpZCk7XG4vLyAgICAgICAgICAgICAgICAgLy8gdGhpcy5mZXRjaCgpO1xuLy8gICAgICAgICAgICAgfSwgZXJyb3IgPT4ge1xuLy8gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiSU5TRVJUIEVSUk9SXCIsIGVycm9yKTtcbi8vICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG4vLyAgICAgfVxuICAgIFxuLy8gICAgIHB1YmxpYyBmZXRjaF9ncm91cHMoKSB7XG4vLyAgICAgICAgIC8vVE9ETy4gRmV0Y2ggcmVjb3N0cnVjdHMgb2JqZWN0cyBiYXNlZCBvbiBpZC5cbiAgICAgICAgXG4vLyAgICAgICAgIGNvbnNvbGUubG9nKFwiZmV0Y2hpbmcgZ3JvdXBzLi4uXCIpO1xuICAgICAgICBcbi8vICAgICAgICAgLy8gdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICBcbi8vICAgICAgICAgdGhpcy5kYXRhYmFzZS5hbGwoXCJTRUxFQ1QgKiBGUk9NIGdyb3Vwc1wiKS50aGVuKHJvd3MgPT4ge1xuLy8gICAgICAgICAgICAgdGhpcy5ncm91cHMgPSBbXTtcbi8vICAgICAgICAgICAgIGZvcih2YXIgcm93IGluIHJvd3MpIHtcbi8vICAgICAgICAgICAgICAgICB0aGlzLmdyb3Vwcy5wdXNoKHtcbi8vICAgICAgICAgICAgICAgICAgICAgXCJpZFwiOnJvd3Nbcm93XVswXSxcbi8vICAgICAgICAgICAgICAgICAgICAgXCJuYW1lXCI6cm93c1tyb3ddWzFdLFxuLy8gICAgICAgICAgICAgICAgICAgICBcInBsYXllcnNOYW1lXCI6XCJcIixcbi8vICAgICAgICAgICAgICAgICAgICAgXCJwbGF5ZXJzXCI6bnVsbFxuLy8gICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICk7XG4vLyAgICAgICAgICAgICBsZXQgbGFzdEdyb3VwID0gdGhpcy5ncm91cHNbdGhpcy5ncm91cHMubGVuZ3RoLTFdO1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJuZXcgZ3JvdXA6IFwiK2xhc3RHcm91cC5uYW1lKTtcbi8vICAgICAgICAgICAgIGxhc3RHcm91cC5wbGF5ZXJzPSB0aGlzLmZldGNoX2dyb3VwX3BsYXllcnMobGFzdEdyb3VwKTtcbi8vICAgICAgICAgfVxuLy8gICAgIH0sIGVycm9yID0+IHtcbi8vICAgICAgICAgY29uc29sZS5sb2coXCJTRUxFQ1QgRVJST1JcIiwgZXJyb3IpO1xuLy8gICAgIH0pO1xuLy8gICAgIHRoaXMuZ3JvdXBGZXRjaF9jb21wbGV0ZWQ9dHJ1ZTtcbi8vIH1cblxuLy8gcHVibGljIGZldGNoX2dyb3VwX3BsYXllcnMoZ3JvdXA6R3JvdXApe1xuLy8gICAgIGxldCBncm91cF9wbGF5ZXJzOiBQbGF5ZXJbXT1bXTtcbiAgICBcbi8vICAgICBjb25zb2xlLmxvZyhcIkZldGNoaW5nIGdyb3VwIHBsYXllcnM6IFwiK2dyb3VwLmlkKTtcblxuICAgIFxuLy8gICAgIHRoaXMuZGF0YWJhc2UuYWxsKFwiU0VMRUNUICogRlJPTSBwbGF5ZXJzIHdoZXJlIGlkID0gMVwiKS50aGVuKHJvd3MgPT4ge1xuLy8gICAgICAgICBncm91cF9wbGF5ZXJzID0gW107XG4vLyAgICAgICAgIGZvcih2YXIgcm93IGluIHJvd3MpIHtcbi8vICAgICAgICAgICAgIGdyb3VwX3BsYXllcnMucHVzaCh7XG4vLyAgICAgICAgICAgICAgICAgXCJpZFwiOnJvd3Nbcm93XVswXSxcbi8vICAgICAgICAgICAgICAgICBcIm5hbWVcIjpyb3dzW3Jvd11bMV0sXG4vLyAgICAgICAgICAgICAgICAgXCJhbnN3ZXJDb3VudFwiOiAwLFxuLy8gICAgICAgICAgICAgICAgIFwicnVubmluZ1BvaW50c1RvdGFsXCI6IDAsXG4vLyAgICAgICAgICAgICAgICAgXCJ0ZWFtXCI6IG51bGwsXG4vLyAgICAgICAgICAgICAgICAgXCJpc1NlbGVjdGVkXCI6ZmFsc2Vcbi8vICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICB9XG4vLyAgICAgfSwgZXJyb3IgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmxvZyhcIlNFTEVDVCBFUlJPUlwiLCBlcnJvcik7XG4vLyAgICAgfSk7XG4gICAgXG4vLyAgICAgcmV0dXJuIGdyb3VwX3BsYXllcnM7XG4vLyB9XG5cbn0iXX0=